
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Making Space Invaders Fun and Accessible with Eye-Movement Gesture Control &#8212; Making Space Invaders Fun and Accessible with Brain-Computer Interfacing</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/enemy2_1.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Making Space Invaders Fun and Accessible with Brain-Computer Interfacing</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1 current">
  <a class="reference internal" href="#">
   Making Space Invaders Fun and Accessible with Eye-Movement Gesture Control
  </a>
 </li>
</ul>
    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Reproducible_Report.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.sydney.edu.au/wdod8520/Aqua10"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.sydney.edu.au/wdod8520/Aqua10/issues/new?title=Issue%20on%20page%20%2FReproducible_Report.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#executive-summary">
   Executive Summary
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#motivation-background">
   Motivation &amp; Background
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#methods">
   Methods
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dependencies">
     Dependencies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#experimentation-data-collection">
     Experimentation &amp; Data Collection
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#physical-experiments-performed">
       Physical Experiments Performed
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#findings">
       Findings
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#collection-of-data">
       Collection of Data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#streaming-algorithm-design">
       Streaming Algorithm Design
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#optimisation">
     Optimisation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#event-detection">
       Event Detection
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#test-statistic">
         Test Statistic
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#maximising-contrast">
         Maximising Contrast
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#threshold-optimisation">
         Threshold Optimisation
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#classification">
       Classification
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#classifiers">
         Classifiers
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#accuracy-metric">
         Accuracy Metric
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#latency-analysis">
         Latency Analysis
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#classifier-optimisation">
         Classifier Optimisation
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#evaluation">
       Evaluation
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#summary-of-results">
   Summary of results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discussion">
   Discussion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contributions">
   Contributions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#appendix">
   Appendix
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#space-invaders-deployment-code">
     Space Invaders Deployment Code
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-set-accuracies">
     Test Set Accuracies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#appendix-time">
     Latency Analysis
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#triggers-and-reset-optimisation">
     Triggers and Reset Optimisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#knn-optimisation">
     KNN Optimisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#max-min-range-optimisation">
     Max-Min-Range Optimisation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="making-space-invaders-fun-and-accessible-with-eye-movement-gesture-control">
<h1>Making Space Invaders Fun and Accessible with Eye-Movement Gesture Control<a class="headerlink" href="#making-space-invaders-fun-and-accessible-with-eye-movement-gesture-control" title="Permalink to this headline">¶</a></h1>
<div class="section" id="executive-summary">
<h2>Executive Summary<a class="headerlink" href="#executive-summary" title="Permalink to this headline">¶</a></h2>
<p>Re-imagining Space Invaders with gesture control brings with it great commercial promise. Additionally, our product can act as a learning tool to introduce individuals, particularly children, to gesture control technology; a need that will inevitably grow as gesture control becomes more integrated into our everyday lives.</p>
<p>Using a Spiker Box from Backyard Brains <span id="id1">[<a class="reference internal" href="#id19">BYB</a>]</span>, our team performed a plethora of experiments to develop an optimal data collection strategy. We chose left and right eye movements to be the controls of our game and recorded the data with electrodes placed horizontally at an optimal spacing of 3cm. Markers were placed at -45<span class="math notranslate nohighlight">\(^\circ\)</span> and 45<span class="math notranslate nohighlight">\(^\circ\)</span> (relative to centre) to improve signal consistency. A calibration period was introduced to control for inter-subject variability.</p>
<p>We used this data to develop a streaming algorithm. By optimising event detection and classification using a sequence of grid searches, the Max-Min-Range classifier had the best tradeoff between latency and accuracy, and hence we chose it for our product.</p>
<p>The optimised classifier was then integrated with the Space Invaders game using inter-process communication and the prototype worked successfully.</p>
</div>
<div class="section" id="motivation-background">
<h2>Motivation &amp; Background<a class="headerlink" href="#motivation-background" title="Permalink to this headline">¶</a></h2>
<p>Over the past two decades, profound advancements in technology such as facial recognition, gesture control, virtual assistants and other instances of machine learning have gradually been integrated into everyday life. With virtual reality worth over $21 billion alone <span id="id2">[<a class="reference internal" href="#id17">VR21</a>]</span>, the gaming industry is evidently undergoing a similar transformation. The financial success of games such as Pokemon Go, which used augmented reality to re-develop the themes and goals of its franchise, is reason enough to design and implement a game that is similarly revamped by one of these technological advancements.</p>
<p>This project uses gesture control, one of these technological advancements, to re-develop Space Invaders to be played with left and right eye movements. Space Invaders is an iconic 80’s game that grossed an equivalent of $13 billion <span id="id3">[<a class="reference internal" href="#id18">con21</a>]</span>, proving the market potential for a re-imagined version.</p>
<p>Our target market is anyone interested in leading technologies and gaming, akin to Pokemon Go’s and the original Space Invaders audience. A short survey was conducted and out of 33 people, 85% said they would be interested in this version of Space Invaders. This demonstrates potential commercial success with a remastered launch.</p>
<p>The fundamental aim of this project is to develop a working prototype for Space Invaders with eye control. This involves collecting data, designing and optimising a streaming classifier capable of distinguishing left and right eye movement,s and integrating this into a Space Invaders game. This becomes an arduous task if solely physics or data science undertook this project. In particular, physics is responsible for collection of representative data and data science will use this data to build and optimise a streaming classifier. Both disciplines cooperated to design an effective workflow, outlined in <a class="reference internal" href="#flow"><span class="std std-numref">Fig. 1</span></a>, to achieve the project aim. Thus, using the skills and knowledge of Physics and Data Science, a well-tested gesture controlled version of Space invaders can be developed.</p>
<div class="figure align-default" id="flow">
<a class="reference internal image-reference" href="_images/flow.png"><img alt="_images/flow.png" src="_images/flow.png" style="width: 827.05px; height: 1063.3px;" /></a>
<p class="caption"><span class="caption-number">Fig. 1 </span><span class="caption-text">Workflow diagram illustrating the process undergone by both Physics and Data Science disciplines in the re-development of the game Space Invaders.</span><a class="headerlink" href="#flow" title="Permalink to this image">¶</a></p>
</div>
<!-- reference by {numref}`flow` --></div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">wavfile</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">fftfreq</span><span class="p">,</span> <span class="n">fftshift</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">catch22</span> <span class="kn">import</span> <span class="n">catch22_all</span>
<span class="kn">import</span> <span class="nn">catch22</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">RFECV</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">weighted_levenshtein</span> <span class="kn">import</span> <span class="n">lev</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">serial</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="c1"># Update this to point to the report folder</span>
<span class="n">PATH</span> <span class="o">=</span> <span class="s2">&quot;../&quot;</span>
<span class="c1"># To run all computation, change to True. Otherwise, precomputed files will be loaded instead.</span>
<span class="n">compute_all</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c1"># If running, ensure the following line is commented out. It disables plots for knitting to html purposes. </span>
<span class="o">%</span><span class="k">matplotlib</span> agg


<span class="c1"># Set seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">420</span><span class="p">)</span> 
<span class="c1"># Path to outputs folder</span>
<span class="n">OUT_PATH</span> <span class="o">=</span> <span class="n">PATH</span> <span class="o">+</span> <span class="s2">&quot;report_outputs/&quot;</span>
<span class="c1"># Path to data</span>
<span class="n">IN_PATH</span> <span class="o">=</span> <span class="n">PATH</span> <span class="o">+</span> <span class="s2">&quot;data/&quot;</span>
<span class="c1"># Path to other file dependencies</span>
<span class="n">DEP_PATH</span> <span class="o">=</span> <span class="n">PATH</span> <span class="o">+</span> <span class="s2">&quot;requirements/other_files/&quot;</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="experimentation-data-collection">
<span id="methods-exp"></span><h3>Experimentation &amp; Data Collection<a class="headerlink" href="#experimentation-data-collection" title="Permalink to this headline">¶</a></h3>
<p>In reference to <a class="reference internal" href="#flow"><span class="std std-numref">Fig. 1</span></a>, the first step in the re-development of Space Invaders requires designing the data collection protocol to collect data representative of the Space Invaders application. The streaming data was collected using a Backyard Brains Spikerbox <span id="id4">[<a class="reference internal" href="#id19">BYB</a>]</span>.</p>
<div class="section" id="physical-experiments-performed">
<h4>Physical Experiments Performed<a class="headerlink" href="#physical-experiments-performed" title="Permalink to this headline">¶</a></h4>
<p>We first experimented with various muscle movements, such as raising eyebrows, blinking, and smiling, and found that each generated a different signal shape. Left and right eye movements were the next investigated and produced distinguishable signals as shown in <a class="reference internal" href="#signals"><span class="std std-numref">Fig. 2</span></a>, and hence were the movements chosen for further experimentation.</p>
<p>Left-right movement experimentation involved varying the angle and distance of the electrodes. This was shown to change the quality drastically. Furthermore, we altered the distance that the subject moved their eyes by placing physical markers at different spacings to act as targets. This also affected signal quality but improved consistency. Aditionally, we experimented with different time between movements, performing sequences in quick and slow succession. And lastly, we experimented on different subjects and investigated the inter-subject variability.</p>
</div>
<div class="section" id="findings">
<span id="methods-findings"></span><h4>Findings<a class="headerlink" href="#findings" title="Permalink to this headline">¶</a></h4>
<p>Left and right signals produced the most distinguishable shapes, and so were chosen as the gestures for our game. The experimental design that produced the cleanest and most consistent signals incorporated the following:</p>
<ul class="simple">
<li><p>Electrodes spaced 3cm apart in a horizontal configuration above the eyebrow.</p></li>
<li><p>Quick eye movements at varied intervals to simulate gameplay.</p></li>
<li><p>Left and right markers placed at -45<span class="math notranslate nohighlight">\(^\circ\)</span> and 45<span class="math notranslate nohighlight">\(^\circ\)</span> relative to the middle.</p></li>
<li><p>Data was collected from more than one individual to get a representative sample.</p></li>
</ul>
<p>A calibration window was recommended to mitigate against the significant inter-subject variability.</p>
<div class="figure align-default" id="signals">
<a class="reference internal image-reference" href="_images/movement_signals.png"><img alt="_images/movement_signals.png" src="_images/movement_signals.png" style="width: 737.1px; height: 529.2px;" /></a>
<p class="caption"><span class="caption-number">Fig. 2 </span><span class="caption-text">Examples of the signal shape of left and right eye movements, as well as an example of noise that we want the classifier to be robust to.</span><a class="headerlink" href="#signals" title="Permalink to this image">¶</a></p>
</div>
<!-- reference by {numref}`signals` --></div>
<div class="section" id="collection-of-data">
<h4>Collection of Data<a class="headerlink" href="#collection-of-data" title="Permalink to this headline">¶</a></h4>
<p>By incorporating the points outlined in <a class="reference internal" href="#methods-findings"><span class="std std-ref">Findings</span></a>, 8 wave files (.wav) were prepared to the following specifications:</p>
<ul class="simple">
<li><p>50s in length</p></li>
<li><p>First 5s is a calibration period - no movements performed</p></li>
<li><p>A sequence of left and right movements are performed for the remaining 45s at varying intervals.</p></li>
<li><p>Each file is accompanied with a labels textfile (.txt) containing the timestamps and labels of every event in the wavefile. ‘1’ corresponds to a left eye movement, and ‘2’ corresponds to a right eye movement.</p></li>
<li><p>Each .wav file has a range of [0, 1024], but are centred to [-512, 512] within the <code class="docutils literal notranslate"><span class="pre">load_data</span></code> function defined below.</p></li>
</ul>
<p>Two of the eight files were randomly selected as the test set, and the rest were assigned to the training set.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">fnames</span><span class="p">,</span> <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shift_factor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">512</span><span class="p">,</span> <span class="n">fix_alessandro</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">offsets</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">waves</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
        <span class="c1"># Load in wave file</span>
        <span class="n">samprate</span><span class="p">,</span> <span class="n">wav_array</span> <span class="o">=</span> <span class="n">wavfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s2">&quot;.wav&quot;</span><span class="p">)</span>
        <span class="n">wav_array</span> <span class="o">=</span> <span class="n">wav_array</span><span class="o">*</span><span class="n">scale_factor</span>
        <span class="n">wav_array</span> <span class="o">+=</span> <span class="n">shift_factor</span>
        <span class="c1"># Fix the bug in alessandro&#39;s code</span>
        <span class="k">if</span> <span class="n">fix_alessandro</span><span class="p">:</span>
            <span class="n">fixed_wav</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">999</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offsets</span><span class="p">[</span><span class="n">file</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wav_array</span><span class="p">)</span><span class="o">-</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fixed_wav</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">step</span><span class="p">]))</span>
                <span class="n">fixed_wav</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">step</span><span class="p">]))</span>
            <span class="n">waves</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">fixed_wav</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">waves</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">wav_array</span>
        <span class="c1"># Load in label file</span>
        <span class="n">labels_dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">labels_dat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span>
        <span class="n">labels_dat</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;L&quot;</span> <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;R&quot;</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels_dat</span><span class="o">.</span><span class="n">label</span><span class="p">]</span>
        <span class="n">labels</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_dat</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">waves</span><span class="p">)</span><span class="si">}</span><span class="s2"> wavefiles:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">waves</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span>
    <span class="k">return</span> <span class="n">waves</span><span class="p">,</span> <span class="n">labels</span>

<span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;data1&quot;</span><span class="p">,</span> <span class="s2">&quot;data2&quot;</span><span class="p">,</span> <span class="s2">&quot;data3&quot;</span><span class="p">,</span> <span class="s2">&quot;data4&quot;</span><span class="p">,</span> <span class="s2">&quot;data5&quot;</span><span class="p">,</span> <span class="s2">&quot;data6&quot;</span><span class="p">,</span> <span class="s2">&quot;data7&quot;</span><span class="p">,</span> <span class="s2">&quot;data8&quot;</span><span class="p">]</span>

<span class="c1"># Offsets to fix the error in alessandro&#39;s code</span>
<span class="n">offsets</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;data1&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
           <span class="s2">&quot;data2&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
           <span class="s2">&quot;data3&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
           <span class="s2">&quot;data4&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
           <span class="s2">&quot;data5&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span>
           <span class="s2">&quot;data6&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
           <span class="s2">&quot;data7&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
           <span class="s2">&quot;data8&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>

<span class="c1"># Randomly select two files for the test set, remainder as training</span>
<span class="n">test_files</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">fnames</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">training_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fnames</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_files</span><span class="p">))</span>

<span class="c1"># Training Data</span>
<span class="n">waves</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span>
    <span class="n">IN_PATH</span><span class="p">,</span> <span class="n">training_files</span><span class="p">,</span> <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shift_factor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">512</span><span class="p">,</span> <span class="n">fix_alessandro</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">offsets</span><span class="o">=</span><span class="n">offsets</span><span class="p">)</span>

<span class="c1"># Test Data</span>
<span class="n">test_waves</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span>
    <span class="n">IN_PATH</span><span class="p">,</span> <span class="n">test_files</span><span class="p">,</span> <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shift_factor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">512</span><span class="p">,</span> <span class="n">fix_alessandro</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">offsets</span><span class="o">=</span><span class="n">offsets</span><span class="p">)</span>

<span class="c1"># Define Calibration Window and Sample Rate: 10,000 Hz</span>
<span class="n">calibration_window_sec</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">samprate</span> <span class="o">=</span> <span class="mi">10_000</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully loaded 6 wavefiles:
data1
data2
data3
data4
data6
data8
Successfully loaded 2 wavefiles:
data5
data7
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Dictionaries to convert singular timestamps in the labels dataframe to </span>
<span class="c1"># the time interval of the entire event and the first hump</span>
<span class="c1"># First hump</span>
<span class="n">time_buffers_hump</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;data1&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">),</span>
    <span class="s2">&quot;data2&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">),</span>
    <span class="s2">&quot;data3&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">),</span>
    <span class="s2">&quot;data4&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
    <span class="s2">&quot;data5&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
    <span class="s2">&quot;data6&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
    <span class="s2">&quot;data7&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">),</span>
    <span class="s2">&quot;data8&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Whole wave</span>
<span class="n">time_buffers_whole</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;data1&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">),</span>
    <span class="s2">&quot;data2&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">),</span>
    <span class="s2">&quot;data3&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">),</span>
    <span class="s2">&quot;data4&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">),</span>
    <span class="s2">&quot;data5&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">),</span>
    <span class="s2">&quot;data6&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">),</span>
    <span class="s2">&quot;data7&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">),</span>
    <span class="s2">&quot;data8&quot;</span><span class="p">:(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">1.35</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="streaming-algorithm-design">
<h4>Streaming Algorithm Design<a class="headerlink" href="#streaming-algorithm-design" title="Permalink to this headline">¶</a></h4>
<p>To begin the development of the classifier, we must design the basic structure of our streaming algorithm. The algorithm will consist of two parts, the first is event detection, and the second is classification. As the streaming data comes in, we will only keep a sliding window at the front of the stream in memory. This window updates in discrete intervals of some <em>buffer length</em>. We will deem this window the <em>classification window</em>.</p>
<p>Within that classification window, a smaller window is fixed, sliding along with the classification window. This subset of the classification window is where we will test for an event, and is hence called the <em>detection window</em>.</p>
<p>Each time the window is updated by the stream, a statistic is generated from the detection window and tested against a threshold to deterimine whether there was an event. To minimise false positives, this criterion will need to pass <code class="docutils literal notranslate"><span class="pre">consecutive_event_triggers</span></code> number of times.</p>
<p>Once the event criterion has passed <code class="docutils literal notranslate"><span class="pre">consecutive_event_triggers</span></code> times, we pass the classification window to the classifier algorithm and block the classifier from detecting another event. When the event criterion has failed <code class="docutils literal notranslate"><span class="pre">consecutive_nonevent_reset</span></code> times, we prime the streaming algorithm to predict events again. This is to stop the algorithm from detecting the same event twice. These parameters were optimised using a gridsearch, the details of which can be found in <a class="reference internal" href="#appendix-consecutive"><span class="std std-ref">Triggers and Reset Optimisation</span></a>.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function that reads in the kth &lt;inputBufferSize&gt; sized segment of the array</span>
<span class="c1"># Simulates streaming condition on recorded wavefiles.</span>
<span class="k">def</span> <span class="nf">read_arduinbro</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">inputBufferSize</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">inputBufferSize</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">wav_array</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">wav_array</span><span class="p">[(</span><span class="n">inputBufferSize</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="p">)):(</span><span class="n">inputBufferSize</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">wav_array</span><span class="p">[(</span><span class="n">inputBufferSize</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="p">))::]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


<span class="c1"># Streaming classifier as described above</span>
<span class="k">def</span> <span class="nf">streaming_classifier</span><span class="p">(</span>
        <span class="n">wav_array</span><span class="p">,</span>                             <span class="c1"># Either the array from file (or ser if live = True)</span>
        <span class="n">samprate</span><span class="p">,</span>
        <span class="n">classifier</span><span class="p">,</span>
        <span class="n">input_buffer_size_sec</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>           <span class="c1"># Buffer size in seconds</span>
        <span class="n">store_events</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>                  <span class="c1"># Whether to return the classification window array for</span>
                                                   <span class="c1"># debugging purposes</span>
        <span class="n">store_times</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>                   <span class="c1"># Store time taken for each classification</span>
    
        <span class="n">live</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>                          <span class="c1"># If live</span>
        <span class="n">FIFO_filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">create_FIFO_msg</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">read_arduino</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">process_data</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

        <span class="n">classifier_params</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="n">classification_window_size_sec</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">,</span>  <span class="c1"># Total detection window [s]</span>

        <span class="n">calibration_window_size_sec</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>       <span class="c1"># The length of the calibration period to define the threshold</span>
        <span class="n">calibration_statistic_function</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># Function that calculates the calibration statistic</span>

        <span class="n">detection_window_size_sec</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">detection_window_offset_sec</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="n">event_test_statistic_function</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Function that calculates the test statistic</span>
        <span class="n">event_threshold_factor</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>          <span class="c1"># The scale factor of the calibration stat that will become</span>
                                                   <span class="c1"># the threshold</span>
        <span class="n">flip_threshold</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>                <span class="c1"># Threshold is a lower bound if true, upper bound if false</span>
        <span class="n">consecutive_event_triggers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>        <span class="c1"># How many threshold triggers need to occur in a row for an </span>
                                                   <span class="c1"># event to be called</span>
        <span class="n">consecutive_nonevent_reset</span> <span class="o">=</span> <span class="mi">10</span>         <span class="c1"># How many threshold failures need to occur in a row for the</span>
                                                   <span class="c1"># classifier to be primed for a new event</span>
        <span class="p">):</span>

    <span class="c1"># Connect to fifo</span>
    <span class="k">if</span> <span class="n">FIFO_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fifo</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">FIFO_filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">store_events</span><span class="p">:</span>
        <span class="n">predictions_storage</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">store_times</span><span class="p">:</span>
        <span class="n">classification_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">predictions_timestamps</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Initialise variables</span>
    <span class="n">N_loops_over_window</span> <span class="o">=</span> <span class="n">classification_window_size_sec</span><span class="o">//</span><span class="n">input_buffer_size_sec</span>
    <span class="n">input_buffer_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">input_buffer_size_sec</span> <span class="o">*</span> <span class="n">samprate</span><span class="p">))</span>
    <span class="n">detection_window_offset</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">detection_window_offset_sec</span> <span class="o">*</span> <span class="n">samprate</span><span class="p">))</span>
    <span class="n">detection_window_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">detection_window_size_sec</span> <span class="o">*</span> <span class="n">samprate</span><span class="p">))</span>
    
    <span class="c1"># Initialise Calibration</span>
    <span class="n">calibrate</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">N_loops_calibration</span> <span class="o">=</span> <span class="n">calibration_window_size_sec</span><span class="o">//</span><span class="n">input_buffer_size_sec</span>

    <span class="c1"># Initialise Event History</span>
    <span class="n">num_event_history</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">consecutive_event_triggers</span><span class="p">,</span>
                            <span class="n">consecutive_nonevent_reset</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> 
    <span class="n">event_history</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="n">num_event_history</span><span class="p">)</span>

    <span class="c1"># Determine length of stream</span>
    <span class="k">if</span> <span class="n">live</span><span class="p">:</span>
        <span class="n">N_loops</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wav_array</span><span class="p">)</span><span class="o">/</span><span class="n">samprate</span>
        <span class="n">N_loops</span> <span class="o">=</span> <span class="p">(</span><span class="n">total_time</span><span class="o">*</span><span class="n">samprate</span><span class="p">)</span><span class="o">//</span><span class="n">input_buffer_size</span>

    <span class="c1"># Prime the classifier for new event</span>
    <span class="n">primed</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1">### Start stream ###</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">N_loops</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">live</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">read_arduino</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span><span class="n">input_buffer_size</span><span class="p">)</span>
            <span class="n">data_temp</span> <span class="o">=</span> <span class="n">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_temp</span> <span class="o">=</span> <span class="n">read_arduinbro</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">input_buffer_size</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">N_loops_over_window</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data_cal</span> <span class="o">=</span> <span class="n">data_temp</span>
                <span class="n">data_window</span> <span class="o">=</span> <span class="n">data_temp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_temp</span><span class="p">,</span> <span class="n">data_window</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">calibrate</span><span class="p">:</span>
                    <span class="n">data_cal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_temp</span><span class="p">,</span> <span class="n">data_cal</span><span class="p">)</span>
            <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data_window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">data_window</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data_temp</span><span class="p">))</span>
            <span class="n">data_window</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">data_temp</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data_temp</span>
            <span class="k">if</span> <span class="n">calibrate</span><span class="p">:</span>
                <span class="n">data_cal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_temp</span><span class="p">,</span><span class="n">data_cal</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="n">N_loops_calibration</span><span class="p">):</span>
                    <span class="n">cal_stat</span> <span class="o">=</span> <span class="n">calibration_statistic_function</span><span class="p">(</span><span class="n">data_cal</span><span class="p">)</span>
                    <span class="n">event_threshold</span> <span class="o">=</span> <span class="n">cal_stat</span><span class="o">*</span><span class="n">event_threshold_factor</span>
                    <span class="n">calibrate</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">k</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">continue</span>
        <span class="c1"># Event Detection</span>
        <span class="c1"># Take detection window from classification window</span>
        
        <span class="n">interval</span> <span class="o">=</span> <span class="n">data_window</span><span class="p">[</span><span class="n">detection_window_offset</span><span class="p">:(</span><span class="n">detection_window_offset</span> <span class="o">+</span> <span class="n">detection_window_size</span><span class="p">)]</span> 
        <span class="n">test_stat</span> <span class="o">=</span> <span class="n">event_test_statistic_function</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span> <span class="c1"># Calculate test stat </span>
                
        <span class="c1"># Test threshold</span>
        <span class="k">if</span> <span class="n">flip_threshold</span><span class="p">:</span>
            <span class="n">is_event</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_stat</span> <span class="o">&lt;</span> <span class="n">event_threshold</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">is_event</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_stat</span> <span class="o">&gt;</span> <span class="n">event_threshold</span><span class="p">)</span>
        
        <span class="c1"># Record History</span>
        <span class="n">event_history</span><span class="p">[</span><span class="mi">1</span><span class="p">::]</span> <span class="o">=</span> <span class="n">event_history</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">event_history</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_event</span>
        
        <span class="c1"># if event, pass window to classifier</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">event_history</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">consecutive_event_triggers</span><span class="p">])</span> <span class="ow">and</span> <span class="n">primed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">store_times</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
            <span class="n">prediction</span> <span class="o">=</span> <span class="n">classifier</span><span class="p">(</span><span class="n">data_window</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="o">**</span><span class="n">classifier_params</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">store_times</span><span class="p">:</span>
                <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time_ns</span><span class="p">()</span>
                <span class="n">classification_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">store_events</span><span class="p">:</span>
                <span class="n">predictions_storage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_window</span><span class="p">)</span>
                        
            <span class="c1"># Record prediction and time interval of event</span>
            <span class="n">predictions</span> <span class="o">+=</span> <span class="n">prediction</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">input_buffer_size_sec</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">classification_window_size_sec</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">predictions_timestamps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_time</span><span class="p">,</span> <span class="n">end_time</span><span class="p">))</span>

            <span class="c1"># Pipe it up</span>
            <span class="k">if</span> <span class="n">FIFO_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">create_FIFO_msg</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fifo</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            
            <span class="c1"># Unprime</span>
            <span class="n">primed</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># Check if condition for priming has been met</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="o">~</span><span class="n">event_history</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">consecutive_nonevent_reset</span><span class="p">]):</span>
            <span class="n">primed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="k">if</span> <span class="n">FIFO_filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fifo</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">store_events</span> <span class="ow">and</span> <span class="n">store_times</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span><span class="p">,</span> <span class="n">predictions_storage</span><span class="p">,</span> <span class="n">classification_times</span>
    <span class="k">elif</span> <span class="n">store_events</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span><span class="p">,</span> <span class="n">predictions_storage</span>
    <span class="k">elif</span> <span class="n">store_times</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span><span class="p">,</span> <span class="n">classification_times</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span>
                  
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="optimisation">
<span id="methods-opt"></span><h3>Optimisation<a class="headerlink" href="#optimisation" title="Permalink to this headline">¶</a></h3>
<p>We optimise the streaming algorithm in two dependent stages as shown in <a class="reference internal" href="#flow"><span class="std std-numref">Fig. 1</span></a>. The first stage is to optimise event detection by choosing the best test statistic and threshold to apply over the detection window. The best test statistic will be the statistic that maximises the contrast between event and non-event regions, and the threshold will be the threshold that maximises the <span class="math notranslate nohighlight">\(F_1\)</span>-score on the training set.</p>
<p>Once event detection is optimised, we will carry over our findings to begin optimising the classifiers using the training set. Once all classifiers are optimised, we will choose the classifier with the best accuracy on the test set based on a Levenshtein distance weighted to reflect the gaming application.</p>
<div class="section" id="event-detection">
<h4>Event Detection<a class="headerlink" href="#event-detection" title="Permalink to this headline">¶</a></h4>
<!-- 
(write lil nicer) Hypothesis from physics perspective: plotting contrast against window length we expect a peak which is the optimal point, taking the appearance of normalisation curve. Thus, two pieces of information (best metric and optimal window length) can be extracted. --><div class="section" id="test-statistic">
<h5>Test Statistic<a class="headerlink" href="#test-statistic" title="Permalink to this headline">¶</a></h5>
<p>The first component to optimising event detection requires choosing the best test statistic to calculate from the detection window. To do this, we first define 5 possible candidates for the test statistic. These candidates were chosen because they were deemed likely to be effective in distinguishing events from non-events.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define Test Stat Functions</span>

<span class="c1"># due to their sine wave-like shape, events have a larger range than non-events</span>
<span class="k">def</span> <span class="nf">ts_range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># the range but using the middle half of the distribution to reduce influence from outliers</span>
<span class="k">def</span> <span class="nf">ts_IQR</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>

<span class="c1"># events have high peaks due to their shape compared to non-events</span>
<span class="k">def</span> <span class="nf">ts_abs_max</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> 
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># non-events cross the zero line (x-axis) often due to noise, </span>
<span class="c1"># while events have long periods over/under the zero line</span>
<span class="k">def</span> <span class="nf">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">::]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Fourier transforms can distinguish between events and non-events due to </span>
<span class="k">def</span> <span class="nf">ts_max_frequency</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">samprate</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">samprate</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">),</span> <span class="n">dt</span><span class="p">)</span>
    <span class="c1"># Num samples</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">yf</span> <span class="o">=</span> <span class="n">fft</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">xf</span> <span class="o">=</span> <span class="n">fftfreq</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xf</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">Sxx</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">spectrogram</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Sxx</span><span class="p">)</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">maximum</span><span class="o">/</span><span class="mi">5</span><span class="p">;</span>
    <span class="n">maximum_Freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Sxx</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># max frequency for each time</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">maximum_Freqs</span><span class="p">)</span>

<span class="n">tfn_candidates</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Range&quot;</span><span class="p">:</span> <span class="n">ts_range</span><span class="p">,</span>
                  <span class="s2">&quot;IQR&quot;</span><span class="p">:</span> <span class="n">ts_IQR</span><span class="p">,</span>
                  <span class="s2">&quot;SD&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span>
                  <span class="s2">&quot;Absolute Max&quot;</span><span class="p">:</span> <span class="n">ts_abs_max</span><span class="p">,</span>
                  <span class="s2">&quot;Zero Crossings&quot;</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="maximising-contrast">
<h5>Maximising Contrast<a class="headerlink" href="#maximising-contrast" title="Permalink to this headline">¶</a></h5>
<p>To choose the best test statistic from the candidates, we first calculate a series of test statistics using a sliding window over each training file. Next, we define an evaluation metric called <em>contrast</em>. Essentially, contrast is the absolute value of the Welch’s t-test statistic between the set of test statistics for event regions, and the set of test statistics for non-event regions. It is defined in <a class="reference internal" href="#equation-contrast">(1)</a>:</p>
<div class="math notranslate nohighlight" id="equation-contrast">
<span class="eqno">(1)<a class="headerlink" href="#equation-contrast" title="Permalink to this equation">¶</a></span>\[\textit{contrast}(E, E^*) = \frac{|\bar{E} - \bar{E^*}|}{\sqrt{\frac{\sigma_E^2}{N_E} + \frac{\sigma_{E^*}^2}{N_{E^*}}}}\]</div>
<!-- reference it by {eq}`contrast` -->
<p>where <span class="math notranslate nohighlight">\(E\)</span> is the set of test statistics calculated over event regions, <span class="math notranslate nohighlight">\(E^*\)</span> is the non-event region test statistics, and <span class="math notranslate nohighlight">\(\bar{k}\)</span>, <span class="math notranslate nohighlight">\(\sigma_k\)</span> and <span class="math notranslate nohighlight">\(N_k\)</span> are the mean, standard deviation and number of elements in set <span class="math notranslate nohighlight">\(k\)</span> respectively.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">contrast</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">non_events</span><span class="p">):</span> 
    <span class="n">pooled_sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">events</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">non_events</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">non_events</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">non_events</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">pooled_sd</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we perform a gridsearch varying the window length from 0s to 2s and calculating the contrast of each candidate statistic for each window length. The results are shown in <a class="reference internal" href="#contrast"><span class="std std-numref">Fig. 3</span></a>. The best test statistic can be seen to be ‘zero crossings’ with an optimal detection window length of 0.43s. Zero crossings is defined in <a class="reference internal" href="#equation-zeros">(2)</a>.</p>
<div class="math notranslate nohighlight" id="equation-zeros">
<span class="eqno">(2)<a class="headerlink" href="#equation-zeros" title="Permalink to this equation">¶</a></span>\[\text{Z}(\mathbf{x}) = \frac{\sum_{i=1}^{n-1} \text{min}\left(\text{sign}(x_i\times x_{i+1}), 0\right)}{n}\]</div>
<!-- reference it by {eq}`zeros` -->
<p>Where <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> is the detection window with <span class="math notranslate nohighlight">\(n\)</span> samples.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_event_regions</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">labels_dat</span><span class="p">,</span> <span class="n">time_buffer</span><span class="p">):</span>
    <span class="n">before_buffer</span> <span class="o">=</span> <span class="n">time_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">after_buffer</span> <span class="o">=</span> <span class="n">time_buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">time_seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wav_array</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">wav_array</span><span class="p">))</span><span class="o">/</span><span class="n">samprate</span>

    <span class="n">left_events_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">time_seq</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">labels_dat</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">labels_dat</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;L&quot;</span><span class="p">]:</span>
        <span class="n">left_events_bool</span> <span class="o">=</span> <span class="p">(((</span><span class="n">time_seq</span> <span class="o">&gt;</span> <span class="n">time</span> <span class="o">-</span> <span class="n">before_buffer</span><span class="p">)</span> <span class="o">&amp;</span> 
                             <span class="p">(</span><span class="n">time_seq</span> <span class="o">&lt;</span> <span class="n">time</span><span class="o">+</span><span class="n">after_buffer</span><span class="p">))</span> <span class="o">|</span> <span class="n">left_events_bool</span><span class="p">)</span>

    <span class="n">right_events_bool</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">time_seq</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">labels_dat</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">labels_dat</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;R&quot;</span><span class="p">]:</span>
        <span class="n">right_events_bool</span> <span class="o">=</span> <span class="p">(((</span><span class="n">time_seq</span> <span class="o">&gt;</span> <span class="n">time</span> <span class="o">-</span> <span class="n">before_buffer</span><span class="p">)</span> <span class="o">&amp;</span> 
                              <span class="p">(</span><span class="n">time_seq</span> <span class="o">&lt;</span> <span class="n">time</span> <span class="o">+</span> <span class="n">after_buffer</span><span class="p">))</span> <span class="o">|</span> <span class="n">right_events_bool</span><span class="p">)</span>

    <span class="n">event_bool</span> <span class="o">=</span> <span class="n">left_events_bool</span> <span class="o">|</span> <span class="n">right_events_bool</span>
    <span class="k">return</span> <span class="n">event_bool</span>


<span class="k">def</span> <span class="nf">get_test_stats</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">test_stat_fns</span><span class="p">):</span>
    <span class="n">test_stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">test_stat_fns</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">wav_array</span><span class="p">)))</span>
    <span class="n">all_windows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">stride_tricks</span><span class="o">.</span><span class="n">sliding_window_view</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">window_shape</span> <span class="o">=</span> <span class="n">window_size</span><span class="p">)</span>
    <span class="n">all_windows</span> <span class="o">=</span> <span class="n">all_windows</span><span class="p">[::</span><span class="n">step</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">fn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_stat_fns</span><span class="p">):</span>
        <span class="n">testicles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">all_windows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">teste</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">testicles</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">testicles</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">test_stats</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">step</span><span class="p">)::]</span> <span class="o">=</span> <span class="n">teste</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">test_stats</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">step</span><span class="p">):((</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">step</span><span class="p">)]</span>  <span class="o">=</span> <span class="n">teste</span>
    <span class="k">return</span> <span class="n">test_stats</span>


<span class="k">def</span> <span class="nf">get_contrast</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">labels_dat</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">test_stat_fns</span><span class="p">,</span> <span class="n">contrast_fn</span><span class="p">,</span> <span class="n">time_buffer</span><span class="p">):</span>
    <span class="n">test_stats</span> <span class="o">=</span> <span class="n">get_test_stats</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">test_stat_fns</span><span class="p">)</span>
    <span class="n">events_bool</span> <span class="o">=</span> <span class="n">get_event_regions</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">labels_dat</span><span class="p">,</span> <span class="n">time_buffer</span><span class="p">)</span>
    <span class="n">event_test_stats</span> <span class="o">=</span> <span class="n">test_stats</span><span class="p">[:,</span> <span class="n">events_bool</span><span class="p">]</span>           
    <span class="n">non_event_test_stats</span> <span class="o">=</span> <span class="n">test_stats</span><span class="p">[:,</span> <span class="o">~</span><span class="n">events_bool</span><span class="p">]</span>
    <span class="n">contrast_stat</span> <span class="o">=</span> <span class="n">contrast_fn</span><span class="p">(</span><span class="n">event_test_stats</span><span class="p">,</span> <span class="n">non_event_test_stats</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">contrast_stat</span>

    
<span class="k">def</span> <span class="nf">contrast_all_files</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">test_stat_fns</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> 
                       <span class="n">waves</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">contrast_fn</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">time_buffers</span><span class="o">=</span><span class="n">time_buffers_whole</span><span class="p">):</span>   
    <span class="n">step</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">step</span><span class="o">*</span><span class="n">samprate</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">waves</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">wav_array</span> <span class="o">=</span> <span class="n">waves</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">labels_dat</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        
        <span class="n">cont</span> <span class="o">=</span> <span class="n">get_contrast</span><span class="p">(</span><span class="n">wav_array</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">labels_dat</span><span class="p">,</span>
                         <span class="n">window_size</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">test_stat_fns</span><span class="p">,</span>
                         <span class="n">contrast_fn</span><span class="p">,</span> <span class="n">time_buffers</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">window_size</span><span class="p">),</span> <span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">cont</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_filename_event_det_opt</span> <span class="o">=</span> <span class="n">OUT_PATH</span> <span class="o">+</span> <span class="s2">&quot;event_detection_optimisation.csv&quot;</span>

<span class="k">if</span> <span class="n">compute_all</span><span class="p">:</span>
    <span class="n">granularity</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">output_filename_event_det_opt</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    <span class="c1"># Clears the file so that the code can be run again.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_filename_event_det_opt</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)):</span>
            <span class="n">x</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">contrast_all_files</span><span class="p">(</span>
                <span class="n">file</span><span class="p">,</span> 
                <span class="n">window_size</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> 
                <span class="n">test_stat_fns</span> <span class="o">=</span> <span class="n">tfn_candidates</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
                <span class="n">samprate</span> <span class="o">=</span> <span class="n">samprate</span><span class="p">,</span>
                <span class="n">waves</span> <span class="o">=</span> <span class="n">waves</span><span class="p">,</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span>
                <span class="n">step</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
                <span class="n">contrast_fn</span> <span class="o">=</span> <span class="n">contrast</span><span class="p">,</span>
                <span class="n">time_buffers</span> <span class="o">=</span> <span class="n">time_buffers_whole</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">contrasts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_filename_event_det_opt</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">contrasts</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">tfn_candidates</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">contrasts_total</span> <span class="o">=</span> <span class="n">contrasts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;window_size&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">tfn_candidates</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">contrasts_total</span><span class="o">.</span><span class="n">index</span><span class="o">/</span><span class="n">samprate</span><span class="p">,</span>
             <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">contrasts_total</span><span class="p">[</span><span class="n">stat</span><span class="p">]),</span>
             <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2"> Contrast&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Event Region Contrast vs. Detection Window&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Detection Window Length (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Contrast (Welch&#39;s t-Test Statistic)&quot;</span><span class="p">)</span>
<span class="n">opt_det_window</span> <span class="o">=</span> <span class="n">contrasts_total</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">contrasts_total</span><span class="p">[</span><span class="s2">&quot;Zero Crossings&quot;</span><span class="p">]))]</span><span class="o">/</span><span class="n">samprate</span>
<span class="n">opt_det_window_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">contrasts_total</span><span class="p">[</span><span class="s2">&quot;Zero Crossings&quot;</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">opt_det_window</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">opt_det_window_val</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> 
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Optimal Point (</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">opt_det_window</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">opt_det_window_val</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">opt_det_window_val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">opt_det_window</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="o">+</span><span class="s2">&quot;contrast.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="contrast">
<a class="reference internal image-reference" href="_images/contrast.png"><img alt="_images/contrast.png" src="_images/contrast.png" style="width: 525.0px; height: 525.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 3 </span><span class="caption-text">Contrast of each test statistic as a function of window size. The contrast is calculated using <a class="reference internal" href="#equation-contrast">(1)</a>. We can see that zero crossings <a class="reference internal" href="#equation-zeros">(2)</a> produces the maximum contrast at a window length of 0.43s.</span><a class="headerlink" href="#contrast" title="Permalink to this image">¶</a></p>
</div>
<!-- reference by {numref}`contrast` --></div>
<div class="section" id="threshold-optimisation">
<h5>Threshold Optimisation<a class="headerlink" href="#threshold-optimisation" title="Permalink to this headline">¶</a></h5>
<p>Now that we have determined the best test statistic and its corresponding optimal detection window length, we will use these to determine the optimal threshold for event detection. To do this, we perform yet another gridsearch to maximise <span class="math notranslate nohighlight">\(F_1\)</span>-score. Instead of searching for the threshold, we instead search for a factor <span class="math notranslate nohighlight">\(f\)</span> which is used to define the threshold using <a class="reference internal" href="#equation-thresh">(3)</a>. This was recommended by the physics team in <a class="reference internal" href="#methods-findings"><span class="std std-ref">Findings</span></a>.</p>
<div class="math notranslate nohighlight" id="equation-thresh">
<span class="eqno">(3)<a class="headerlink" href="#equation-thresh" title="Permalink to this equation">¶</a></span>\[t = f\times \text{Z}(\mathbf{c})\]</div>
<!-- reference it by {eq}`thresh` -->
<p>Where <span class="math notranslate nohighlight">\(t\)</span> is the threshold, <span class="math notranslate nohighlight">\(f\)</span> is the threshold factor, Z is defined in <a class="reference internal" href="#equation-zeros">(2)</a> and <span class="math notranslate nohighlight">\(\mathbf{c}\)</span> is the calibration window.</p>
<p>We have used the <span class="math notranslate nohighlight">\(F_1\)</span>-score to determine the performance of the event detection as it weighs the false positives and false negatives equally. Both false positives and false negatives are undesirable for our application: a false positive would mean an involuntary movement and a false negative would a missed movement, both scenarios endanger the player’s spaceship. <span class="math notranslate nohighlight">\(F_1\)</span>-score is defined in <a class="reference internal" href="#equation-f1">(4)</a>.</p>
<div class="math notranslate nohighlight" id="equation-f1">
<span class="eqno">(4)<a class="headerlink" href="#equation-f1" title="Permalink to this equation">¶</a></span>\[F_1 = \frac{\text{TP}}{\text{TP}+\frac{1}{2}(\text{FP} + \text{FN})}\]</div>
<!-- reference it by {eq}`f1` -->
<p>The results of the gridsearch are displayed below in <a class="reference internal" href="#threshold"><span class="std std-numref">Fig. 4</span></a>.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_filename_thresh_opt</span> <span class="o">=</span> <span class="n">OUT_PATH</span> <span class="o">+</span> <span class="s2">&quot;threshold_optimisation.csv&quot;</span>

<span class="k">if</span> <span class="n">compute_all</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_filename_thresh_opt</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span> <span class="c1"># Clear file</span>
        <span class="k">for</span> <span class="n">st_scale</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
            <span class="n">fps</span><span class="p">,</span> <span class="n">fns</span><span class="p">,</span> <span class="n">tps</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">waves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span> <span class="o">=</span> <span class="n">streaming_classifier</span><span class="p">(</span>
                    <span class="n">waves</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="n">samprate</span><span class="p">,</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="s2">&quot;R&quot;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span>
                    <span class="n">input_buffer_size_sec</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
                    <span class="n">classification_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>
                    <span class="n">detection_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>
                    <span class="n">detection_window_offset_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">calibration_window_size_sec</span> <span class="o">=</span> <span class="n">calibration_window_sec</span><span class="p">,</span>
                    <span class="n">calibration_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">event_test_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
                    <span class="n">event_threshold_factor</span> <span class="o">=</span> <span class="n">st_scale</span><span class="p">,</span> 
                    <span class="n">flip_threshold</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                    <span class="n">consecutive_event_triggers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                    <span class="n">consecutive_nonevent_reset</span> <span class="o">=</span> <span class="mi">10</span> 
                <span class="p">)</span>
                <span class="n">before_buffer</span> <span class="o">=</span> <span class="n">time_buffers_hump</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">after_buffer</span> <span class="o">=</span> <span class="n">time_buffers_hump</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">actual_times</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t</span><span class="o">-</span><span class="n">before_buffer</span><span class="p">,</span> <span class="n">t</span><span class="o">+</span><span class="n">after_buffer</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">]</span>
                <span class="n">actual_leftovers</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">actual_times</span><span class="p">)</span>
                <span class="n">pred_leftovers</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">predictions_timestamps</span><span class="p">)</span>
                <span class="n">tps</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_times</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">act_times</span> <span class="ow">in</span> <span class="n">actual_times</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">act_times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">calibration_window_sec</span><span class="p">:</span>
                        <span class="n">actual_leftovers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">act_times</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">pred_times</span> <span class="ow">in</span> <span class="n">predictions_timestamps</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">act_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pred_times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">act_times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pred_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                            <span class="n">pred_times</span> <span class="ow">in</span> <span class="n">pred_leftovers</span> <span class="ow">and</span> <span class="n">act_times</span> <span class="ow">in</span> <span class="n">actual_leftovers</span><span class="p">):</span>
                            <span class="n">actual_leftovers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">act_times</span><span class="p">)</span>
                            <span class="n">pred_leftovers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pred_times</span><span class="p">)</span>
                <span class="n">tps</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_leftovers</span><span class="p">)</span>
                <span class="n">fns</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_leftovers</span><span class="p">)</span>
                <span class="n">fps</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_leftovers</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fscore</span> <span class="o">=</span> <span class="n">tps</span><span class="o">/</span><span class="p">(</span><span class="n">tps</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">fns</span><span class="o">+</span><span class="n">fps</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">st_scale</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="o">%</span><span class="k">10</span> == 0:
                <span class="nb">print</span><span class="p">(</span><span class="n">st_scale</span><span class="p">,</span> <span class="n">fscore</span><span class="p">)</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">st_scale</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">fscore</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">thresholds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_filename_thresh_opt</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">thresholds</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;threshold_factor&quot;</span><span class="p">,</span> <span class="s2">&quot;f_score&quot;</span><span class="p">]</span> 

<span class="n">thresh_factors</span> <span class="o">=</span> <span class="n">thresholds</span><span class="o">.</span><span class="n">threshold_factor</span>
<span class="n">f_score_list</span> <span class="o">=</span> <span class="n">thresholds</span><span class="o">.</span><span class="n">f_score</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresh_factors</span><span class="p">,</span> <span class="n">f_score_list</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$F_1$-Score vs. Threshold Factor</span><span class="se">\n</span><span class="s2"> for Zero Crossings&quot;</span><span class="p">)</span>
<span class="n">opt_thresh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">thresh_factors</span><span class="p">[</span><span class="n">f_score_list</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f_score_list</span><span class="p">)])</span>
<span class="n">opt_fscore</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f_score_list</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">opt_thresh</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">opt_fscore</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> 
           <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Optimal Point (</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">opt_thresh</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">opt_fscore</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">opt_fscore</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">opt_thresh</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Threshold Factor&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$F_1$-Score&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="o">+</span><span class="s2">&quot;threshold.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="threshold">
<a class="reference internal image-reference" href="_images/threshold.png"><img alt="_images/threshold.png" src="_images/threshold.png" style="width: 525.0px; height: 525.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 4 </span><span class="caption-text">Plot of the <span class="math notranslate nohighlight">\(F_1\)</span>-score for different threshold factors on the training set. The threshold is obtained by <a class="reference internal" href="#equation-thresh">(3)</a>. We find the highest <span class="math notranslate nohighlight">\(F_1\)</span>-score occurs when the threshold factor is 0.33.</span><a class="headerlink" href="#threshold" title="Permalink to this image">¶</a></p>
</div>
<!-- reference by {numref}`threshold` --></div>
</div>
<div class="section" id="classification">
<h4>Classification<a class="headerlink" href="#classification" title="Permalink to this headline">¶</a></h4>
<div class="section" id="classifiers">
<h5>Classifiers<a class="headerlink" href="#classifiers" title="Permalink to this headline">¶</a></h5>
<p>Now that the event detection has been optimised, we must now optimise classification. To do this, the data science team developed five classifiers, each aiming to capture a different distinguishing feature identified by the physics team in their investigations <a class="reference internal" href="#methods-exp"><span class="std std-ref">Experimentation &amp; Data Collection</span></a>. In particular, <em>One Extrema</em> applies a Savitzky-Golay filter, as per the physicists’ recommendations in <a class="reference internal" href="#methods-findings"><span class="std std-ref">Findings</span></a>, and looks to identify whether the first turning point is a maximum (R) or minimum (L). <em>Two Extrema</em> does the same, but looks for a max followed by a min (R) or vice versa (L). <em>Max-Min</em> essentially does the same as <em>Two Extrema</em> but without filtering. <em>Max-Min-Range</em> applies a correction to <em>Max-Min</em> so that it only considers a point to be a maximum or minimum when it is above a certain threshold distance from the origin, governed by the <code class="docutils literal notranslate"><span class="pre">rng</span></code> parameter. The optimisation of this parameter can be found in <a class="reference internal" href="#appendix-maxminrange"><span class="std std-ref">Max-Min-Range Optimisation</span></a>. Additionally, we developed a knn classifier, the optimisation of which can be found in <a class="reference internal" href="#appendix-knn"><span class="std std-ref">KNN Optimisation</span></a>. Finally, we implement a naive classifer for a baseline, which randomly predicts an event as either L or R.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare Classifier Candidates</span>

<span class="c1"># catch22 kNN classifier (using stepwise selected features)</span>
<span class="n">step_csv</span> <span class="o">=</span> <span class="n">DEP_PATH</span><span class="o">+</span><span class="s2">&quot;catch22_step_selected_features.csv&quot;</span>
<span class="n">catch22_step_training_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">step_csv</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">catch22_step_training_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">y_labels</span> <span class="o">=</span> <span class="n">catch22_step_training_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   
<span class="n">neigh</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_labels</span><span class="p">)</span>


<span class="c1"># calculates the 5 features selected from catch22, find the 5 nearest neighbours </span>
<span class="c1"># calculated using Euclidean distance, then selects the majority classification</span>
<span class="k">def</span> <span class="nf">catch22_knn_classifier</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">downsample_rate</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">arr_ds</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">downsample_rate</span><span class="p">]</span>
    <span class="n">arr_list</span> <span class="o">=</span> <span class="n">arr_ds</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">feature_one</span> <span class="o">=</span> <span class="n">catch22</span><span class="o">.</span><span class="n">DN_HistogramMode_5</span><span class="p">(</span><span class="n">arr_list</span><span class="p">)</span>
    <span class="n">feature_two</span> <span class="o">=</span> <span class="n">catch22</span><span class="o">.</span><span class="n">SB_BinaryStats_mean_longstretch1</span><span class="p">(</span><span class="n">arr_list</span><span class="p">)</span>
    <span class="n">feature_three</span> <span class="o">=</span> <span class="n">catch22</span><span class="o">.</span><span class="n">FC_LocalSimple_mean1_tauresrat</span><span class="p">(</span><span class="n">arr_list</span><span class="p">)</span>
    <span class="n">feature_four</span> <span class="o">=</span> <span class="n">catch22</span><span class="o">.</span><span class="n">DN_OutlierInclude_p_001_mdrmd</span><span class="p">(</span><span class="n">arr_list</span><span class="p">)</span>
    <span class="n">feature_five</span> <span class="o">=</span> <span class="n">catch22</span><span class="o">.</span><span class="n">SP_Summaries_welch_rect_area_5_1</span><span class="p">(</span><span class="n">arr_list</span><span class="p">)</span>
    <span class="n">test_features</span> <span class="o">=</span> <span class="p">[[</span><span class="n">feature_one</span><span class="p">,</span> <span class="n">feature_two</span><span class="p">,</span> <span class="n">feature_three</span><span class="p">,</span> <span class="n">feature_four</span><span class="p">,</span> <span class="n">feature_five</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">neigh</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_features</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>                    

<span class="c1"># wave is smoothed using Savitzky-Golay Filter, then decides whether the event is</span>
<span class="c1"># a left or right depending on whether the first turning point is a max or min</span>
<span class="k">def</span> <span class="nf">one_extrema_smoothing_classifier</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">downsample_rate</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">window_size_seconds</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">max_loops</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">arr_ds</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">downsample_rate</span><span class="p">]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">samprate</span><span class="o">/</span><span class="n">downsample_rate</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_ds</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">),</span> <span class="n">dt</span><span class="p">)</span>

    <span class="c1"># Smooth wave</span>
    <span class="n">window_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_size_seconds</span><span class="o">*</span><span class="n">samprate</span><span class="o">/</span><span class="n">downsample_rate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">filtered_arr</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">arr_ds</span><span class="p">,</span> <span class="n">window_length</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Indices of positive maxima</span>
    <span class="n">max_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">argrelextrema</span><span class="p">(</span><span class="n">filtered_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">max_vals</span> <span class="o">=</span> <span class="n">filtered_arr</span><span class="p">[</span><span class="n">max_locs</span><span class="p">]</span>
    <span class="n">max_locs</span> <span class="o">=</span> <span class="n">max_locs</span><span class="p">[</span><span class="n">max_vals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Indices of negative minima</span>
    <span class="n">min_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">argrelextrema</span><span class="p">(</span><span class="n">filtered_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">min_vals</span> <span class="o">=</span> <span class="n">filtered_arr</span><span class="p">[</span><span class="n">min_locs</span><span class="p">]</span>
    <span class="n">min_locs</span> <span class="o">=</span> <span class="n">min_locs</span><span class="p">[</span><span class="n">min_vals</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="n">max_min_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_locs</span><span class="p">,</span> <span class="n">min_locs</span><span class="p">)</span>    <span class="c1"># Appended indices</span>
    <span class="n">max_min_values</span> <span class="o">=</span> <span class="n">filtered_arr</span><span class="p">[</span><span class="n">max_min_locs</span><span class="p">]</span>     <span class="c1"># Values of above indices    </span>
    <span class="n">abs_max_min_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_min_values</span><span class="p">)</span>     <span class="c1"># Absolute value of those values</span>

    <span class="c1"># A vector with a length equal to the number of minimums: all &#39;-1&#39; to say minimum</span>
    <span class="n">numMin</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">min_locs</span><span class="p">)</span>    
    <span class="n">numMax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">max_locs</span><span class="p">)</span>     <span class="c1"># Same for max, but with &#39;1&#39;</span>
    <span class="n">isMin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numMax</span><span class="p">,</span> <span class="n">numMin</span><span class="p">)</span>
    <span class="n">val_and_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">abs_max_min_values</span><span class="p">,</span> <span class="n">max_min_locs</span><span class="p">,</span> <span class="n">isMin</span><span class="p">])</span>
    <span class="c1"># Sort the magnitudes of the extrema in descending order (-1 indicates descending)</span>
    <span class="n">val_and_idx_sorted</span> <span class="o">=</span> <span class="n">val_and_idx</span><span class="p">[</span> <span class="p">:,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">val_and_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>

    <span class="k">if</span> <span class="n">val_and_idx_sorted</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">val_and_idx_sorted</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;L&#39;</span>
        <span class="k">elif</span> <span class="n">val_and_idx_sorted</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;R&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;_&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">val_and_idx_sorted</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;L&#39;</span>
        <span class="k">elif</span> <span class="n">val_and_idx_sorted</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;R&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;_&quot;</span>

<span class="c1"># wave is smoothed using Savitzky-Golay Filter, then decides whether the event is</span>
<span class="c1"># a left or right depending on the order of the maximum and minimum turning points</span>
<span class="k">def</span> <span class="nf">two_extrema_smoothing_classifier</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">downsample_rate</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                                       <span class="n">window_size_seconds</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">max_loops</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">arr_ds</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">downsample_rate</span><span class="p">]</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">samprate</span><span class="o">/</span><span class="n">downsample_rate</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">fs</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr_ds</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">),</span> <span class="n">dt</span><span class="p">)</span>

    <span class="c1"># Smooth wave</span>
    <span class="n">window_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">window_size_seconds</span><span class="o">*</span><span class="n">samprate</span><span class="o">/</span><span class="n">downsample_rate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">filtered_arr</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">arr_ds</span><span class="p">,</span> <span class="n">window_length</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Indices of positive maxima</span>
    <span class="n">max_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">argrelextrema</span><span class="p">(</span><span class="n">filtered_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">max_vals</span> <span class="o">=</span> <span class="n">filtered_arr</span><span class="p">[</span><span class="n">max_locs</span><span class="p">]</span>
    <span class="n">max_locs</span> <span class="o">=</span> <span class="n">max_locs</span><span class="p">[</span><span class="n">max_vals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Indices of negative minima</span>
    <span class="n">min_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">argrelextrema</span><span class="p">(</span><span class="n">filtered_arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">less</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">min_vals</span> <span class="o">=</span> <span class="n">filtered_arr</span><span class="p">[</span><span class="n">min_locs</span><span class="p">]</span>
    <span class="n">min_locs</span> <span class="o">=</span> <span class="n">min_locs</span><span class="p">[</span><span class="n">min_vals</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>
    
    <span class="n">max_min_locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_locs</span><span class="p">,</span> <span class="n">min_locs</span><span class="p">)</span>    <span class="c1"># Appended indices</span>
    <span class="n">max_min_values</span> <span class="o">=</span> <span class="n">filtered_arr</span><span class="p">[</span><span class="n">max_min_locs</span><span class="p">]</span>     <span class="c1"># Values of above indices    </span>
    <span class="n">abs_max_min_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_min_values</span><span class="p">)</span>     <span class="c1"># Absolute value of those values</span>

    <span class="c1"># A vector with a length equal to the number of minimums: all &#39;-1&#39; to say minimum</span>
    <span class="n">numMin</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">min_locs</span><span class="p">)</span>    
    <span class="n">numMax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">max_locs</span><span class="p">)</span>     <span class="c1"># Same for max, but with &#39;1&#39;</span>
    <span class="n">isMin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numMax</span><span class="p">,</span> <span class="n">numMin</span><span class="p">)</span>
    <span class="n">val_and_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">abs_max_min_values</span><span class="p">,</span> <span class="n">max_min_locs</span><span class="p">,</span> <span class="n">isMin</span><span class="p">])</span>
    <span class="c1"># Sort the magnitudes of the extrema in descending order (-1 indicates descending)</span>
    <span class="n">val_and_idx_sorted</span> <span class="o">=</span> <span class="n">val_and_idx</span><span class="p">[</span> <span class="p">:,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">val_and_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
    
    <span class="c1"># We will continue looping until we have an appropriate classification. </span>
    <span class="c1"># This relies on having the extrema INTERCHANGE between max and min (no two min right next to eachother)</span>
    <span class="n">loops</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">classificationFound</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">classificationFound</span> <span class="ow">and</span> <span class="n">loops</span> <span class="o">&lt;</span> <span class="n">max_loops</span><span class="p">:</span>
        
        <span class="n">top_2</span> <span class="o">=</span> <span class="n">val_and_idx_sorted</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>             <span class="c1"># Take the top two magnitudes</span>
        <span class="n">top_2_sorted</span> <span class="o">=</span> <span class="n">top_2</span><span class="p">[</span> <span class="p">:,</span> <span class="n">top_2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>   <span class="c1"># Sort according to the indices of those values</span>
        <span class="k">if</span> <span class="n">top_2_sorted</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>               <span class="c1"># Break if we run out of turning points</span>
            <span class="k">return</span> <span class="s2">&quot;_&quot;</span>
        
        <span class="c1"># If two min or two max occur one after the other, </span>
        <span class="c1"># we know we have an inappropriate result so we delete one of those doubled min/max</span>
        <span class="k">if</span> <span class="n">top_2_sorted</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">top_2_sorted</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">val_and_idx_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">val_and_idx_sorted</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">classificationFound</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">loops</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">top_2_sorted</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;L&#39;</span>
    <span class="k">elif</span> <span class="n">top_2_sorted</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;R&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;_&quot;</span>

<span class="c1"># finds the index of the max and min values in the wave, then classifies</span>
<span class="c1"># based on whether the max or min value occurred first</span>
<span class="k">def</span> <span class="nf">max_min_classifier</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">downsample_rate</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">arr_ds</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">downsample_rate</span><span class="p">]</span>
    <span class="n">arr_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">arr_ds</span><span class="p">)</span>
    <span class="n">arr_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">arr_ds</span><span class="p">)</span>
    <span class="n">max_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_ds</span> <span class="o">==</span> <span class="n">arr_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_ds</span> <span class="o">==</span> <span class="n">arr_min</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_loc</span> <span class="o">&gt;</span> <span class="n">min_loc</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;R&quot;</span>
    <span class="k">elif</span> <span class="n">min_loc</span> <span class="o">&gt;</span> <span class="n">max_loc</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;L&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;_&quot;</span>

<span class="c1"># finds the index of the max and min values in the wave, then checks whether both</span>
<span class="c1"># values are outside the range. If both are outside, then classification is based</span>
<span class="c1"># on whether max or min value occurred first. Else, if only one is outside, then</span>
<span class="c1"># classification is based on whether the max or min&#39;s magnitude is larger</span>
<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">max_min_range_classifier</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">samprate</span><span class="p">,</span> <span class="n">downsample_rate</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rng</span> <span class="o">=</span> <span class="mi">35</span><span class="p">):</span>
    <span class="n">arr_ds</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">downsample_rate</span><span class="p">]</span>
    <span class="n">arr_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">arr_ds</span><span class="p">)</span>
    <span class="n">arr_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">arr_ds</span><span class="p">)</span>
    <span class="n">max_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_ds</span> <span class="o">==</span> <span class="n">arr_max</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr_ds</span> <span class="o">==</span> <span class="n">arr_min</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">arr_max</span> <span class="o">&gt;</span> <span class="n">rng</span> <span class="ow">and</span> <span class="n">arr_min</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">rng</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">max_loc</span> <span class="o">&gt;</span> <span class="n">min_loc</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;R&quot;</span>
        <span class="k">elif</span> <span class="n">min_loc</span> <span class="o">&gt;</span> <span class="n">max_loc</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;L&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;_&quot;</span>
    <span class="k">elif</span> <span class="n">arr_max</span> <span class="o">&gt;</span> <span class="n">rng</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;R&quot;</span>
    <span class="k">elif</span> <span class="n">arr_min</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">rng</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;L&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;_&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prepare classifiers for optimisation and plotting</span>
<span class="n">classifiers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;One-Extrema&quot;</span><span class="p">:</span> <span class="n">one_extrema_smoothing_classifier</span><span class="p">,</span>
               <span class="s2">&quot;Two-Extrema&quot;</span><span class="p">:</span> <span class="n">two_extrema_smoothing_classifier</span><span class="p">,</span>
               <span class="s2">&quot;Max-Min&quot;</span><span class="p">:</span> <span class="n">max_min_classifier</span><span class="p">,</span>
               <span class="s2">&quot;Max-Min-Range&quot;</span><span class="p">:</span> <span class="n">max_min_range_classifier</span><span class="p">,</span>
               <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="n">catch22_knn_classifier</span><span class="p">,</span>
               <span class="s2">&quot;Naive Random&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="s2">&quot;R&quot;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;L&quot;</span><span class="p">}</span>

<span class="n">classifier_parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;One-Extrema&quot;</span><span class="p">:</span> <span class="p">{},</span>
               <span class="s2">&quot;Two-Extrema&quot;</span><span class="p">:</span> <span class="p">{},</span>
               <span class="s2">&quot;Max-Min&quot;</span><span class="p">:</span> <span class="p">{},</span>
               <span class="s2">&quot;Max-Min-Range&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;rng&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">},</span>
               <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="p">{},</span>
               <span class="s2">&quot;Naive Random&quot;</span><span class="p">:</span> <span class="p">{}}</span>

<span class="n">classifier_colours</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;One-Extrema&quot;</span><span class="p">:</span> <span class="s2">&quot;tab:blue&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Two-Extrema&quot;</span><span class="p">:</span> <span class="s2">&quot;tab:cyan&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Max-Min&quot;</span><span class="p">:</span> <span class="s2">&quot;tab:olive&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Max-Min-Range&quot;</span><span class="p">:</span> <span class="s2">&quot;tab:brown&quot;</span><span class="p">,</span>
               <span class="s2">&quot;KNN&quot;</span><span class="p">:</span> <span class="s2">&quot;tab:pink&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Naive Random&quot;</span><span class="p">:</span> <span class="s2">&quot;tab:red&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="accuracy-metric">
<h5>Accuracy Metric<a class="headerlink" href="#accuracy-metric" title="Permalink to this headline">¶</a></h5>
<p>To estimate the accuracy of our classifier, we have opted to use weighted Levenshtein distance. The Levenshtein distance measures the minimum number of deletions, insertions or replacements required to transform one sequence into the other. Our metric weighs replacements and deletions more heavily than insertions, counting a replacement and a deletion as 1.25 and insertions as 0.5. When playing the game, a misclassification (fixed by replacement) would be quite costly, as the game would be doing the opposite of the instruction given. A false positive event (fixed by a deletion) where it detects an event when no instruction was given would also be costly. In contrast, a missed event (fixed by an insertion) is far less costly as the player can simply redo the eye movement. This justifies using the weighted Levenshtein distance to calculate accuracy. Once the weighted Levenshtein distance is calculated, the accuracy is computed using <a class="reference internal" href="#equation-lev">(5)</a>:</p>
<div class="math notranslate nohighlight" id="equation-lev">
<span class="eqno">(5)<a class="headerlink" href="#equation-lev" title="Permalink to this equation">¶</a></span>\[a = \frac{l-D_{lv}}{l}\]</div>
<!-- reference it by {eq}`lev` -->
<p>where <span class="math notranslate nohighlight">\(a\)</span> is the accuracy, <span class="math notranslate nohighlight">\(l\)</span> is the length of the actual sequence and <span class="math notranslate nohighlight">\(D_{lv}\)</span> is the weighted Levenshtein distance.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_lev_dist</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">sub_L_cost</span> <span class="o">=</span> <span class="mf">1.25</span><span class="p">,</span> <span class="n">sub_R_cost</span> <span class="o">=</span> <span class="mf">1.25</span><span class="p">,</span>
                <span class="n">sub_under_score_cost</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">delete_under_score_cost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">delete_L_cost</span> <span class="o">=</span> <span class="mf">1.25</span><span class="p">,</span> <span class="n">delete_R_cost</span> <span class="o">=</span> <span class="mf">1.25</span><span class="p">):</span>
    <span class="n">substitute_costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  
    <span class="n">substitute_costs</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sub_L_cost</span>
    <span class="n">substitute_costs</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sub_R_cost</span>
    <span class="n">substitute_costs</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sub_under_score_cost</span>
    <span class="n">substitute_costs</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">),</span> <span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sub_under_score_cost</span>
    <span class="n">delete_costs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="n">delete_costs</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">delete_under_score_cost</span>
    <span class="n">delete_costs</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">delete_L_cost</span>
    <span class="n">delete_costs</span><span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">delete_R_cost</span>
    <span class="k">return</span> <span class="n">lev</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="n">actual</span><span class="p">,</span> <span class="n">substitute_costs</span> <span class="o">=</span> <span class="n">substitute_costs</span><span class="p">,</span> <span class="n">delete_costs</span> <span class="o">=</span> <span class="n">delete_costs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="latency-analysis">
<h5>Latency Analysis<a class="headerlink" href="#latency-analysis" title="Permalink to this headline">¶</a></h5>
<p>The actual time taken for each algorithm to classify is negligible when compared to the time taken for the classificaiton window to come in (see <a class="reference internal" href="#appendix-time"><span class="std std-ref">Latency Analysis</span></a> for more information). This means the lag is dominated by the length of the classification window. Hence, the accuracy defined in <a class="reference internal" href="#equation-lev">(5)</a> must be balanced with a minimum classification window length to optimise the classifier’s performance.</p>
</div>
<div class="section" id="classifier-optimisation">
<h5>Classifier Optimisation<a class="headerlink" href="#classifier-optimisation" title="Permalink to this headline">¶</a></h5>
<p>Once the metric has been defined, a series of grid searches were performed for classifier to optimise the classification window size. Using the detection window as a base, an extension was applied on either side of the detection window to slowly widen the classification window. This extension was varied from 0s to 1.65s in increments of 0.00825s and the accuracy at each step is shown in <a class="reference internal" href="#classifier"><span class="std std-numref">Fig. 5</span></a>.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_filename_cls_opt</span> <span class="o">=</span> <span class="n">OUT_PATH</span> <span class="o">+</span> <span class="s2">&quot;classifier_optimisation.csv&quot;</span>

<span class="k">if</span> <span class="n">compute_all</span><span class="p">:</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">output_filename_cls_opt</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    <span class="c1"># Clear the file</span>

    <span class="n">search_space</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="n">opt_det_window</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">granularity</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="k">for</span> <span class="n">classifier_label</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">classifier_label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">search_space</span><span class="p">,</span> <span class="n">granularity</span><span class="p">)):</span>
            <span class="n">w</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">%</span><span class="p">(</span><span class="n">granularity</span><span class="o">//</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">granularity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">classification_window</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">w</span>
            <span class="n">buffer_size</span> <span class="o">=</span> <span class="mf">0.05</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">waves</span><span class="p">):</span>
                <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span> <span class="o">=</span> <span class="n">streaming_classifier</span><span class="p">(</span>
                    <span class="n">waves</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="n">samprate</span><span class="p">,</span>
                    <span class="n">classifier</span><span class="p">,</span>
                    <span class="n">classifier_params</span><span class="o">=</span><span class="n">classifier_parameters</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">],</span>
                    <span class="n">input_buffer_size_sec</span> <span class="o">=</span> <span class="n">buffer_size</span><span class="p">,</span>
                    <span class="n">classification_window_size_sec</span> <span class="o">=</span> <span class="n">classification_window</span><span class="p">,</span>
                    <span class="n">detection_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>
                    <span class="n">detection_window_offset_sec</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span>
                    <span class="n">calibration_window_size_sec</span> <span class="o">=</span> <span class="n">calibration_window_sec</span><span class="p">,</span>
                    <span class="n">calibration_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">event_test_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
                    <span class="n">event_threshold_factor</span> <span class="o">=</span> <span class="n">opt_thresh</span><span class="p">,</span> 
                    <span class="n">flip_threshold</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="c1"># Threshold is a lower bound, so true</span>
                    <span class="n">consecutive_event_triggers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                    <span class="n">consecutive_nonevent_reset</span> <span class="o">=</span> <span class="mi">10</span> 
                <span class="p">)</span>
                <span class="n">actuals</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="n">lev_dist</span> <span class="o">=</span> <span class="n">my_lev_dist</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">actuals</span><span class="p">)</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span> <span class="o">-</span> <span class="n">lev_dist</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_filename_cls_opt</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">classifier_label</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">classification_window</span><span class="p">),</span> 
                                         <span class="n">key</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">actuals</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_dist</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">acc</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_filename_cls_opt</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="s2">&quot;window_size&quot;</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;predicted&quot;</span><span class="p">,</span> <span class="s2">&quot;actual&quot;</span><span class="p">,</span> <span class="s2">&quot;lev_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">]</span>
<span class="n">results_agg</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;window_size&quot;</span><span class="p">,</span> <span class="s2">&quot;classifier&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">results_agg</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">optimal_cl_windows</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">classifier</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="n">filt</span> <span class="o">=</span> <span class="n">results_agg</span><span class="o">.</span><span class="n">classifier</span> <span class="o">==</span> <span class="n">classifier</span>
    <span class="n">max_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">results_agg</span><span class="p">[</span><span class="n">filt</span><span class="p">]</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">results_agg</span><span class="p">[</span><span class="n">filt</span><span class="p">]</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">optimal_cl_window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results_agg</span><span class="p">[</span><span class="n">filt</span><span class="p">]</span><span class="o">.</span><span class="n">window_size</span><span class="p">)[</span><span class="n">max_arg</span><span class="p">]</span>
    <span class="n">optimal_cl_windows</span><span class="p">[</span><span class="n">classifier</span><span class="p">]</span> <span class="o">=</span> <span class="n">optimal_cl_window</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">results_agg</span><span class="p">[</span><span class="n">filt</span><span class="p">]</span><span class="o">.</span><span class="n">window_size</span><span class="p">,</span> <span class="n">signal</span><span class="o">.</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">results_agg</span><span class="p">[</span><span class="n">filt</span><span class="p">]</span><span class="o">.</span><span class="n">accuracy</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
             <span class="n">label</span><span class="o">=</span><span class="n">classifier</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">optimal_cl_window</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">max_val</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> 
             <span class="n">color</span><span class="o">=</span><span class="n">classifier_colours</span><span class="p">[</span><span class="n">classifier</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">optimal_cl_window</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">classifier_colours</span><span class="p">[</span><span class="n">classifier</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Weighted Levenshtein Accuracy&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Classification Window Length (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Classifier Accuracy vs. Classification Window Length&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">opt_det_window</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Detection Window Lowerbound&quot;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="o">+</span><span class="s2">&quot;classifier.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="classifier">
<a class="reference internal image-reference" href="_images/classifier.png"><img alt="_images/classifier.png" src="_images/classifier.png" style="width: 525.0px; height: 525.0px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">Training accuracy of each classifier as a function of classification window length. The classification window is lower bounded by the detection window, represented by the shaded region.
Ideally, we want to minimise window length while maximising accuracy. With this in mind, we see that the Max-Min-Range classifier has the highest accuracy at a window length equal to be the lowerbound of 0.43s. This makes it the most optimal classifier by both accuracy and latency.</span><a class="headerlink" href="#classifier" title="Permalink to this image">¶</a></p>
</div>
<!-- reference by {numref}`classifier` --></div>
</div>
<div class="section" id="evaluation">
<h4>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h4>
<p>Now that we have optimised each classifier using the training set, we must assess each classifier’s out-of-sample performance. To do this, we calculate the average accuracy on the test set. We found that Max-Min had the highest accuracy of 90% with a window size of 1.23s, closely followed by Max-Min-Range at 88% with a window size of 0.43s (the full results can be found in <a class="reference internal" href="#appendix-test"><span class="std std-ref">Test Set Accuracies</span></a>).</p>
<p>Since Max-Min-Range has good accuracy with a significantly lower window size, we choose it as the classifier to deploy within our game.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_filename_tst_res</span> <span class="o">=</span> <span class="n">OUT_PATH</span> <span class="o">+</span> <span class="s2">&quot;test_results.csv&quot;</span>

<span class="k">if</span> <span class="n">compute_all</span><span class="p">:</span>
    <span class="nb">open</span><span class="p">(</span><span class="n">output_filename_tst_res</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    <span class="c1"># Clear the file</span>

    <span class="k">for</span> <span class="n">classifier_label</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">classifier_label</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">optimal_cl_windows</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">]</span> <span class="o">-</span> <span class="n">opt_det_window</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">buffer_size</span> <span class="o">=</span> <span class="mf">0.05</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_waves</span><span class="p">):</span>
            <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span> <span class="o">=</span> <span class="n">streaming_classifier</span><span class="p">(</span>
                <span class="n">test_waves</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                <span class="n">samprate</span><span class="p">,</span>
                <span class="n">classifier</span><span class="p">,</span>
                <span class="n">classifier_params</span><span class="o">=</span><span class="n">classifier_parameters</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">],</span>
                <span class="n">input_buffer_size_sec</span> <span class="o">=</span> <span class="n">buffer_size</span><span class="p">,</span>
                <span class="n">classification_window_size_sec</span> <span class="o">=</span> <span class="n">optimal_cl_windows</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">],</span>
                <span class="n">detection_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>
                <span class="n">detection_window_offset_sec</span> <span class="o">=</span> <span class="n">offset</span><span class="p">,</span>
                <span class="n">calibration_window_size_sec</span> <span class="o">=</span> <span class="n">calibration_window_sec</span><span class="p">,</span>
                <span class="n">calibration_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                <span class="n">event_test_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
                <span class="n">event_threshold_factor</span> <span class="o">=</span> <span class="n">opt_thresh</span><span class="p">,</span> 
                <span class="n">flip_threshold</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">consecutive_event_triggers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                <span class="n">consecutive_nonevent_reset</span> <span class="o">=</span> <span class="mi">10</span> 
            <span class="p">)</span>
            <span class="n">actuals</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
            <span class="n">lev_dist</span> <span class="o">=</span> <span class="n">my_lev_dist</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">actuals</span><span class="p">)</span>
            <span class="n">acc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span> <span class="o">-</span> <span class="n">lev_dist</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_filename_tst_res</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">classifier_label</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">actuals</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">lev_dist</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">acc</span><span class="p">)])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">test_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_filename_tst_res</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_results</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Classifier&quot;</span><span class="p">,</span> <span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;Predicted&quot;</span><span class="p">,</span> <span class="s2">&quot;Actual&quot;</span><span class="p">,</span> <span class="s2">&quot;Weighted Levenshtein Distance&quot;</span><span class="p">,</span> <span class="s2">&quot;Accuracy&quot;</span><span class="p">]</span>

<span class="n">test_results</span> <span class="o">=</span> <span class="n">test_results</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Classifier&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">)</span>

<span class="n">top_accs</span> <span class="o">=</span> <span class="n">test_results</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">test_results</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="n">top_windows</span> <span class="o">=</span> <span class="p">[</span><span class="n">optimal_cl_windows</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">test_results</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

<span class="n">top_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="n">top_df</span><span class="p">[</span><span class="s2">&quot;Classifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top</span>
<span class="n">top_df</span><span class="p">[</span><span class="s2">&quot;Accuracy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">top_accs</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">top_df</span><span class="p">[</span><span class="s2">&quot;Window Length (s)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">top_windows</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="summary-of-results">
<h2>Summary of results<a class="headerlink" href="#summary-of-results" title="Permalink to this headline">¶</a></h2>
<p>After experimenting with different methods of data collection, we found the best data collection method involved spacing the electrodes 3cm apart. Furthermore, performing quick movements produced the clearest signal and limiting movements to left and right simplified the classifier so that we could effectively achieve the aim.</p>
<p>Using the data collected, we found the optimal test statistic was zero crossings at a detection window size of 0.43s with a threshold factor was 0.33, show in <a class="reference internal" href="#contrast"><span class="std std-numref">Fig. 3</span></a> and <a class="reference internal" href="#threshold"><span class="std std-numref">Fig. 4</span></a>. We decided to use the Max-Min-Range classifier with a classification window size equal to the aforementioned detection window. We chose this classifier because of its excellent performance in both accuracy and latency, which will make our game accurate and responsive.</p>
<p>Finally, to integrate the classifier into Space Invaders, we adapted a team member’s existing Java implementation into Python. The optimised Max-Min-Range classifier was then merged with the game. Despite both working well independently, the combined product was initially quite laggy. This was resolved by running the classifier and game separately and having them interact via inter-process communication. Details of the deployment can be found in <a class="reference internal" href="#appendix-deployment"><span class="std std-ref">Space Invaders Deployment Code</span></a>.</p>
</div>
<div class="section" id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¶</a></h2>
<p>Initially, the Spike Recorder software was used to record the training dataset. However, the data was drastically different when transitioning to live data from Python. Both the threshold and shape of the signals varied between the two. This led to us executing the entire pipeline outlined in <a class="reference internal" href="#flow"><span class="std std-numref">Fig. 1</span></a> again with new data recorded directly from Python.</p>
<p>The data obtained from the Python software had a tendency to be volatile as the random noise varied greatly with different people. This was solved by the physicists recommendation of a calibration period; having the player keep their eyes still for 5s at the start of play. This allowed us to define the threshold more robustly using <a class="reference internal" href="#equation-thresh">(3)</a>. Additionally, some classifiers aimed to address noise by using a Savitzky-Golay filter.</p>
<p>Latency was a major problem in the initial stages of this project. There was a significant time delay between the eye movement and the <code class="docutils literal notranslate"><span class="pre">streaming_classifier</span></code> function being able to classify the eye movement. This was overcome by significantly reducing the window size. Additionally, when running the <code class="docutils literal notranslate"><span class="pre">streaming_classifier</span></code> function and the game in one file, we encountered significant lag. We resolved this by separating the function and the game into different files, running them simultaneously and interfacing them using inter-process communication detailed in <a class="reference internal" href="#appendix-deployment"><span class="std std-ref">Space Invaders Deployment Code</span></a>.</p>
<p>We focused on optimising the core mechanics of left and right eye movements. In future, additional features could be added to the game such as blinking or muscle movements to implement controlled shooting. Multiplayer could also be implemented in a similar way. Making the game a self-contained application would also improve the ease of use for a consumer market.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Throughout this project, physics and data science disciplines collaborated to achieve the aim of developing prototype of gesture-controlled Space Invaders. By developing and evaluating numerous classifiers using curated data from the physicists, we were able to develop a fast and accurate classifier for use in a functioning game. Due to the time restrictions, we were limited in the amount of controls we were able to implement, having only left and right eye movements. However, we aspire to develop future upgrades to the game. These include having user-inputted shooting executed by another control such as blinks or muscle movements and creating a multiplayer option. Despite the challenging nature of this project, we were able to combine data science and physics expertise to develop a very successful final product.</p>
</div>
<div class="section" id="contributions">
<h2>Contributions<a class="headerlink" href="#contributions" title="Permalink to this headline">¶</a></h2>
<p>Student 490423356 was responsible for editing the given python streaming code to save the input as a wav file, and automate logging the time keys were pressed during data collection (key presses were used to signal the event an eye movement). They aided in the construction and implementation of physical experiments to determine the most appropriate final experimental design.They implemented an event detection method which uses Fourier transforms, that was evaluated by the group in the test statistic graphical analysis. They performed research on six different types of normalisation techniques that could be used for preprocessing an input signal. Some of these were transformed into event detection statistics, such as Z-Score. They additionally proposed the idea to have a calibration period, which the group agreed is a better method to generalise the signal for all users rather than normalisation. They designed and implemented an adaptation of the existing two and three extrema classifiers, to make them more robust to unexpected changes in the signal. This student wrote the speech for the final presentation. They were also responsible for organising meeting times and having the PowerPoint ready for each Monday presentation (with help from other group members).</p>
<p>Student 490413128: Wrote the Max-Min classifier and the Max-Min-Range classifier. Significantly contributed to writing the code for the evaluation. Researched and implemented Inter-Process Communication. Collected a lot of data. Contributed significantly to writing the discussion section. Helped in writing the methods section. Wrote the results section of the report. Rewrote the executive summary so that the report fell within the word limit. Helped in creating the Powerpoint for each Monday presentation.</p>
<p>480366780 contributed to this project through generating reliable and robust data that was used to evaluate the accuracy of the classifiers. They worked on finding distinct signals that we were able to be incorporated as the controls of the game. They evaluated the optimal positioning of the electrodes and distance the eye must move to generate the clearest and most noticeable signals. They created a survey that allowed us to gain a better understanding of the public’s interest towards our project which also helped shape our motivation. They helped with implementing Fourier transforms as an alternative option for event detection and aided in the research of using pipes. They created the slides for the final presentation, helped write the speech and wrote parts of the final report. They also helped research Inter-Process Communication.</p>
<p>Student 490155963 contributed to this project by converting the Space Invaders he had from Java into Python. He also helped with recording some of the data. He was the primary team member working on merging the classifier and game together, and reducing the lag the combined product was producing. He implemented the classifier on the game with the help of a pipe data processing structure.</p>
<p>Student 490388088 contributed to this project by exploring a machine-learning alternative to the rule-based classifiers the other data science members made. He explored how to use catch22, performed feature selection, and created a k-nearest neighbours classifier to complement the other classifiers. He also made great contributions to the editing of the report to ensure it flowed and well represented the project as a whole.</p>
<p>Student 480380144: Developed the structure for our streaming classifier, translating it from R. Also designed the data science pipeline to optimise our classifiers. This involved designing and performing experiments to optimise for each of the parameters in the streaming classifier, specifically detection and classification window lengths. Additionally, they played a key role in writing our report, despite breaking their hand two weeks from the due date which meant they could only work effectively on it a few days out from the due date. Their report contributions included setting up Jupyter Book and interlacing the sections with the code for reproducibility. Overall, their most important contribution was providing direction to our group. By laying out the experimental pipeline, it allowed all group members to contribute to the final product more effectively.</p>
</div>
<div class="section" id="appendix">
<h2>Appendix<a class="headerlink" href="#appendix" title="Permalink to this headline">¶</a></h2>
<div class="section" id="space-invaders-deployment-code">
<span id="appendix-deployment"></span><h3>Space Invaders Deployment Code<a class="headerlink" href="#space-invaders-deployment-code" title="Permalink to this headline">¶</a></h3>
<p>Below is the final classifier used in the game, as well as a link to the game itself and the functions used to connect the two with inter-process communication.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code for inter-process communication between the game and the classifier.</span>
<span class="k">def</span> <span class="nf">encode_msg_size</span><span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;I&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_msg</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">encode_msg_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">content</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Functions for Serial</span>
<span class="k">def</span> <span class="nf">read_arduino</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span><span class="n">inputBufferSize</span><span class="p">):</span>
<span class="c1">#     data = ser.readline((inputBufferSize+1)*2)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">((</span><span class="n">inputBufferSize</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span><span class="p">[(</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">data_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_in</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">data_in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">:</span>
            <span class="c1"># Found beginning of frame</span>
            <span class="c1"># Extract one sample from 2 bytes</span>
            <span class="n">intout</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">data_in</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">127</span><span class="p">))</span><span class="o">*</span><span class="mi">128</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">intout</span> <span class="o">=</span> <span class="n">intout</span> <span class="o">+</span> <span class="n">data_in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="n">intout</span><span class="p">)</span>
        <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">-</span><span class="mi">512</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Final classifier used for Space Invaders</span>

<span class="c1"># Connect to spiker box - change to match port</span>
<span class="c1"># cport = &quot;/dev/cu.usbserial-DJ00E33Q&quot;</span>
<span class="c1"># baudrate = 230400</span>
<span class="c1"># ser = serial.Serial(port=cport, baudrate=baudrate)    </span>
<span class="c1"># inputBufferSize = 1000   # 20000 = 1 second</span>
<span class="c1"># buffer_size_sec = inputBufferSize/20000.0</span>
<span class="c1"># ser.timeout = buffer_size_sec  # set read timeout 20000</span>

<span class="c1"># classifier_label = &quot;Max-Min-Range&quot;</span>
<span class="c1"># offset = (optimal_cl_windows[classifier_label] - opt_det_window)/2</span>
<span class="c1"># buffer_size = 0.05</span>
<span class="c1"># streaming_classifier(</span>
<span class="c1">#     ser,</span>
<span class="c1">#     samprate,</span>
<span class="c1">#     classifiers[classifier_label],</span>
<span class="c1">#     classifier_params=classifier_parameters[classifier_label],</span>
<span class="c1">#     input_buffer_size_sec = buffer_size_sec,</span>
<span class="c1">#     classification_window_size_sec = optimal_cl_windows[classifier_label],</span>
<span class="c1">#     detection_window_size_sec = opt_det_window,</span>
<span class="c1">#     detection_window_offset_sec = offset,</span>
<span class="c1">#     calibration_window_size_sec = calibration_window_sec,</span>
<span class="c1">#     calibration_statistic_function = lambda x: ts_zero_crossings(x)/len(x),</span>
<span class="c1">#     event_test_statistic_function = lambda x: ts_zero_crossings(x)/len(x), </span>
<span class="c1">#     event_threshold_factor = opt_thresh, </span>
<span class="c1">#     flip_threshold = True, </span>
<span class="c1">#     consecutive_event_triggers = 3, </span>
<span class="c1">#     consecutive_nonevent_reset = 10,</span>
<span class="c1">#     live = True,</span>
<span class="c1">#     FIFO_filename = &quot;space_invaders_ipc&quot;,</span>
<span class="c1">#     create_FIFO_msg = create_msg,</span>
<span class="c1">#     read_arduino = read_arduino,</span>
<span class="c1">#     process_data = process_data</span>
<span class="c1">#     )</span>
</pre></div>
</div>
</div>
</div>
<p>The game can be found in the Space_Invaders subfolder within the report folder. To run the game, run space_invaders.py in one terminal, and run the code defined above in another <strong>in that order</strong>. You will need to ensure the Spiker Box is connected to the correct port via the Serial python package.</p>
</div>
<div class="section" id="test-set-accuracies">
<span id="appendix-test"></span><h3>Test Set Accuracies<a class="headerlink" href="#test-set-accuracies" title="Permalink to this headline">¶</a></h3>
<p>Below are the accuracies for all classifiers on the test set, along with their optimal window sizes.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Classifier</th>
      <th>Accuracy</th>
      <th>Window Length (s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Max-Min</td>
      <td>0.90</td>
      <td>1.23</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Max-Min-Range</td>
      <td>0.88</td>
      <td>0.43</td>
    </tr>
    <tr>
      <th>2</th>
      <td>One-Extrema</td>
      <td>0.85</td>
      <td>0.81</td>
    </tr>
    <tr>
      <th>3</th>
      <td>KNN</td>
      <td>0.78</td>
      <td>0.51</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Two-Extrema</td>
      <td>0.70</td>
      <td>1.06</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Naive Random</td>
      <td>0.61</td>
      <td>1.76</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="appendix-time">
<span id="id5"></span><h3>Latency Analysis<a class="headerlink" href="#appendix-time" title="Permalink to this headline">¶</a></h3>
<p>Below is the plot showing how long each classifier took to classify every event in the training set. Since the order of magnitude is milliseconds, this justifies focusing on minimising window length as that is of order seconds.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">buffer_size_sec</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">all_classification_times</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">better_all_classification_times</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">classifier_label</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">waves</span><span class="p">):</span>
        <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">streaming_classifier</span><span class="p">(</span>
            <span class="n">waves</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
            <span class="n">samprate</span><span class="p">,</span>
            <span class="n">classifiers</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">],</span>
            <span class="n">classifier_params</span><span class="o">=</span><span class="n">classifier_parameters</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">],</span>
            <span class="n">input_buffer_size_sec</span> <span class="o">=</span> <span class="n">buffer_size_sec</span><span class="p">,</span>
            <span class="n">classification_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>
            <span class="n">detection_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>
            <span class="n">detection_window_offset_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">calibration_window_size_sec</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
            <span class="n">calibration_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">event_test_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
            <span class="n">event_threshold_factor</span> <span class="o">=</span> <span class="n">opt_thresh</span><span class="p">,</span> 
            <span class="n">flip_threshold</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
            <span class="n">store_times</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">consecutive_event_triggers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
            <span class="n">consecutive_nonevent_reset</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">live</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">classifier_label</span> <span class="ow">in</span> <span class="n">better_all_classification_times</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">better_all_classification_times</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">]</span> <span class="o">+=</span> <span class="n">times</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">better_all_classification_times</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">times</span>


        <span class="k">if</span> <span class="s2">&quot;times&quot;</span> <span class="ow">in</span> <span class="n">all_classification_times</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">all_classification_times</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
            <span class="n">all_classification_times</span><span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classifier_label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_classification_times</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_classification_times</span><span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_classification_times</span><span class="p">[</span><span class="s2">&quot;times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
            <span class="n">all_classification_times</span><span class="p">[</span><span class="s2">&quot;classifier&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">classifier_label</span><span class="p">)</span>
        
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">better_all_classification_times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">better_all_classification_times</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="o">/</span><span class="mf">1e6</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">better_all_classification_times</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">better_all_classification_times</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Time Taken (ms)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Classifier&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Time Taken to Classify Each Event (Classification Window Length of 0.43s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">OUT_PATH</span><span class="o">+</span><span class="s2">&quot;classifier_times.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="times" src="_images/classifier_times.png" /></p>
</div>
<div class="section" id="triggers-and-reset-optimisation">
<span id="appendix-consecutive"></span><h3>Triggers and Reset Optimisation<a class="headerlink" href="#triggers-and-reset-optimisation" title="Permalink to this headline">¶</a></h3>
<p>Below is the gridsearch used to optimise <code class="docutils literal notranslate"><span class="pre">consecutive_event_triggers</span></code> and <code class="docutils literal notranslate"><span class="pre">consecutive_nonevent_reset</span></code>. We chose the minimum pair with optimal f score of 0.993 - (3, 10). A minimum pair minimises latency.</p>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Gridsearch to optimise consecutive_event_triggers and consecutive_nonevent_reset</span>
<span class="c1"># Chose minimum pair with optimal f score of 0.993 - (3, 10). A minimum pair minimises latency</span>
<span class="k">if</span> <span class="n">compute_all</span><span class="p">:</span>
    <span class="n">trigset</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">trigs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">reset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>
            <span class="n">fscores</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">waves</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">fps</span><span class="p">,</span> <span class="n">fns</span><span class="p">,</span> <span class="n">tps</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span> <span class="o">=</span> <span class="n">streaming_classifier</span><span class="p">(</span>
                    <span class="n">waves</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="n">samprate</span><span class="p">,</span>
                    <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="s2">&quot;R&quot;</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">&lt;</span><span class="mf">0.5</span> <span class="k">else</span> <span class="s2">&quot;L&quot;</span><span class="p">,</span>
                    <span class="n">input_buffer_size_sec</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
                    <span class="n">classification_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>
                    <span class="n">detection_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>
                    <span class="n">detection_window_offset_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">calibration_window_size_sec</span> <span class="o">=</span> <span class="n">calibration_window_sec</span><span class="p">,</span>
                    <span class="n">calibration_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">event_test_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
                    <span class="n">event_threshold_factor</span> <span class="o">=</span> <span class="mf">0.33</span><span class="p">,</span> 
                    <span class="n">flip_threshold</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                    <span class="n">consecutive_event_triggers</span> <span class="o">=</span> <span class="n">trigs</span><span class="p">,</span> 
                    <span class="n">consecutive_nonevent_reset</span> <span class="o">=</span> <span class="n">reset</span>
                <span class="p">)</span>
                <span class="n">before_buffer</span> <span class="o">=</span> <span class="n">time_buffers_hump</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">after_buffer</span> <span class="o">=</span> <span class="n">time_buffers_hump</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">actual_times</span> <span class="o">=</span> <span class="p">[(</span><span class="n">time</span><span class="o">-</span><span class="n">before_buffer</span><span class="p">,</span> <span class="n">time</span><span class="o">+</span><span class="n">after_buffer</span><span class="p">)</span> <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">]</span>
                <span class="n">actual_leftovers</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">actual_times</span><span class="p">)</span>
                <span class="n">pred_leftovers</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">predictions_timestamps</span><span class="p">)</span>
                <span class="n">tps</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_times</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">act_times</span> <span class="ow">in</span> <span class="n">actual_times</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">act_times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">calibration_window_sec</span><span class="p">:</span>
                        <span class="n">actual_leftovers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">act_times</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="k">for</span> <span class="n">pred_times</span> <span class="ow">in</span> <span class="n">predictions_timestamps</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">act_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pred_times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">act_times</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">pred_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span>
                            <span class="n">pred_times</span> <span class="ow">in</span> <span class="n">pred_leftovers</span> <span class="ow">and</span> <span class="n">act_times</span> <span class="ow">in</span> <span class="n">actual_leftovers</span><span class="p">):</span>
                            <span class="n">actual_leftovers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">act_times</span><span class="p">)</span>
                            <span class="n">pred_leftovers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">pred_times</span><span class="p">)</span>
                <span class="n">tps</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_leftovers</span><span class="p">)</span>
                <span class="n">fns</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actual_leftovers</span><span class="p">)</span>
                <span class="n">fps</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_leftovers</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">fscore</span> <span class="o">=</span> <span class="n">tps</span><span class="o">/</span><span class="p">(</span><span class="n">tps</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">fns</span><span class="o">+</span><span class="n">fps</span><span class="p">))</span>
                <span class="n">fscores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fscore</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">trigs</span><span class="p">,</span> <span class="n">reset</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fscores</span><span class="p">))</span>
            <span class="n">trigset</span><span class="p">[(</span><span class="n">trigs</span><span class="p">,</span> <span class="n">reset</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fscores</span><span class="p">)</span>


        
        
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="knn-optimisation">
<span id="appendix-knn"></span><h3>KNN Optimisation<a class="headerlink" href="#knn-optimisation" title="Permalink to this headline">¶</a></h3>
<p>Below is the code used to perform feature selection on the features calculated using catch22 for the kNN classifier. An external set of data was used to determine these features as to not bias the optimisation process undertaken in <a class="reference internal" href="#methods-opt"><span class="std std-ref">Optimisation</span></a>.
This feature data was saved to <code class="docutils literal notranslate"><span class="pre">catch22_step_selected_features.csv</span></code> for use in the kNN classifier. The method undertaken to perform feature selection is described in <span id="id6">[<a class="reference internal" href="#id23">Bil18</a>]</span>.</p>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Using backward stepwise feature selection from catch22 for kNN classifier </span>

<span class="c1"># import decision tree classifier to model fitting and recursive feature exclusion (stepwise selection)</span>

<span class="n">KNN_DATA_PATH</span> <span class="o">=</span> <span class="n">IN_PATH</span> <span class="o">+</span> <span class="s2">&quot;KNN/&quot;</span>

<span class="n">knn_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;left-middle-right-middle#2&#39;</span><span class="p">,</span> <span class="s1">&#39;left-middle-right-middle&#39;</span><span class="p">,</span> <span class="s1">&#39;left-middle-right-steph&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;left-middle-right-steph2&#39;</span><span class="p">,</span> <span class="s1">&#39;left-middle&#39;</span><span class="p">,</span> <span class="s1">&#39;left-right-middle-marina&#39;</span><span class="p">,</span> <span class="s1">&#39;left-right-middle-marina2&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;left-right-middle-marina3&#39;</span><span class="p">,</span> <span class="s1">&#39;left-right-middle-sandeep&#39;</span><span class="p">,</span> <span class="s1">&#39;right-middle&#39;</span><span class="p">]</span>

<span class="c1"># Load the data</span>
<span class="n">knn_waves</span><span class="p">,</span> <span class="n">knn_labels</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span>
    <span class="n">KNN_DATA_PATH</span><span class="p">,</span> <span class="n">knn_names</span><span class="p">,</span> <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shift_factor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">512</span><span class="p">,</span> <span class="n">fix_alessandro</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Define sample rate: 10,000 Hz</span>
<span class="n">samprate</span> <span class="o">=</span> <span class="mi">10_000</span>

<span class="c1"># Extract events from training data</span>
<span class="n">before_buffer</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">after_buffer</span> <span class="o">=</span> <span class="mi">1</span>
    
<span class="n">events</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of events in terms of slice of wav_array</span>
<span class="n">event_labels</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># list of labels</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">knn_labels</span><span class="p">:</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="n">knn_waves</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">knn_labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">lab</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">time</span><span class="p">):</span>
        <span class="n">event_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
        <span class="n">event_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">before_buffer</span><span class="p">)</span> <span class="o">*</span> <span class="n">samprate</span><span class="p">)</span> <span class="c1"># in terms of sampling rate</span>
        <span class="n">event_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">t</span> <span class="o">+</span> <span class="n">after_buffer</span><span class="p">)</span> <span class="o">*</span> <span class="n">samprate</span><span class="p">)</span> <span class="c1"># in terms of sampling rate</span>

        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wave</span><span class="p">[</span><span class="n">event_start</span><span class="p">:</span><span class="n">event_end</span><span class="p">])</span>
        
<span class="c1"># Compute catch22 features and convert to dataframe</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
    <span class="n">event_ds</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">10</span><span class="p">]</span> <span class="c1"># downsample by a rate of 10</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">catch22_all</span><span class="p">(</span><span class="n">event_ds</span><span class="p">)</span>
    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">])</span>

<span class="n">features_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="n">features_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span>

<span class="c1"># fit the model</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">420</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_df</span><span class="p">,</span> <span class="n">event_labels</span><span class="p">)</span>

<span class="c1"># Python backward stepwise selection</span>
<span class="n">trans</span> <span class="o">=</span> <span class="n">RFECV</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">features_trans</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">features_df</span><span class="p">,</span> <span class="n">event_labels</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">features_trans</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">columns_retained</span> <span class="o">=</span> <span class="n">features_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">trans</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span><span class="o">.</span><span class="n">values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">columns_retained</span><span class="p">)</span>

<span class="c1"># create df to save as csv for kNN classifier</span>
<span class="n">selected_features_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">features_trans</span><span class="p">)</span>
<span class="n">selected_features_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns_retained</span>
<span class="n">selected_features_df</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_labels</span>

<span class="c1"># selected_features_df.to_csv(DEP_PATH+&#39;catch22_step_selected_features.csv&#39;,index=False)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="max-min-range-optimisation">
<span id="appendix-maxminrange"></span><h3>Max-Min-Range Optimisation<a class="headerlink" href="#max-min-range-optimisation" title="Permalink to this headline">¶</a></h3>
<p>The following code performs a grid search to optimise the <code class="docutils literal notranslate"><span class="pre">rng</span></code> threshold for the Max-Min-Range classifier. The <code class="docutils literal notranslate"><span class="pre">rng</span></code> threshold is varied from 0 to 100 in increments of 1, and the corresponding weighted Levenshtein accuracies are plotted.</p>
<div class="cell tag_hide-input tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classifiers1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Max-Min-Range&quot;</span><span class="p">:</span> <span class="n">max_min_range_classifier</span><span class="p">}</span>

<span class="n">file_accuracies</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">buffer_size_sec</span> <span class="o">=</span> <span class="mf">0.05</span>

<span class="k">if</span> <span class="n">compute_all</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">classifier_label</span><span class="p">,</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifiers1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1">#offset = (optimal_cl_windows[classifier_label] - opt_det_window)/2</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">classifier_label</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">range_threshold</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">101</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Current Range Threshold:&quot;</span><span class="p">,</span> <span class="n">range_threshold</span><span class="p">)</span>

            <span class="n">current_accuracies</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">waves</span><span class="p">):</span>
                
                <span class="n">predictions</span><span class="p">,</span> <span class="n">predictions_timestamps</span> <span class="o">=</span> <span class="n">streaming_classifier</span><span class="p">(</span>
                    <span class="n">waves</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                    <span class="n">samprate</span><span class="p">,</span>
                    <span class="n">classifiers</span><span class="p">[</span><span class="n">classifier_label</span><span class="p">],</span>
                    <span class="n">classifier_params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;rng&quot;</span> <span class="p">:</span> <span class="n">range_threshold</span><span class="p">},</span>
                    <span class="n">input_buffer_size_sec</span> <span class="o">=</span> <span class="n">buffer_size_sec</span><span class="p">,</span>
                    <span class="n">classification_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>  <span class="c1">#opt_det_window + 0.01</span>
                    <span class="n">detection_window_size_sec</span> <span class="o">=</span> <span class="n">opt_det_window</span><span class="p">,</span>       <span class="c1">#opt_det_window</span>
                    <span class="n">detection_window_offset_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="c1">#offset ^ uncomment it above</span>
                    <span class="n">calibration_window_size_sec</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
                    <span class="n">calibration_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                    <span class="n">event_test_statistic_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ts_zero_crossings</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> 
                    <span class="n">event_threshold_factor</span> <span class="o">=</span> <span class="mf">0.33</span><span class="p">,</span>          <span class="c1">#opt_thresh </span>
                    <span class="n">flip_threshold</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                    <span class="n">consecutive_event_triggers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
                    <span class="n">consecutive_nonevent_reset</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
                    <span class="n">live</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">actuals</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>

                <span class="n">lev_dist</span> <span class="o">=</span> <span class="n">my_lev_dist</span><span class="p">(</span><span class="n">actuals</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span> <span class="o">-</span> <span class="n">lev_dist</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">actuals</span><span class="p">)</span>
                <span class="n">current_accuracies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">acc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">range_threshold</span> <span class="ow">in</span> <span class="n">file_accuracies</span><span class="p">:</span>
                <span class="n">file_accuracies</span><span class="p">[</span><span class="n">range_threshold</span><span class="p">]</span> <span class="o">+=</span> <span class="n">current_accuracies</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file_accuracies</span><span class="p">[</span><span class="n">range_threshold</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_accuracies</span>


    <span class="n">ave_accuracies_per_range_val</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">range_thresh</span><span class="p">,</span> <span class="n">acc_each_file_ls</span> <span class="ow">in</span> <span class="n">file_accuracies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ave_accuracies_per_range_val</span><span class="p">[</span><span class="n">range_thresh</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">acc_each_file_ls</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc_each_file_ls</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span>

    <span class="n">best_ranges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_value</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">ave_accuracies_per_range_val</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">acc</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">round</span><span class="p">(</span><span class="n">best_value</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>  <span class="c1">#need to round because python maintains its floats very imprecisly</span>
            <span class="n">best_value</span> <span class="o">=</span> <span class="n">acc</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ave_accuracies_per_range_val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="nb">round</span><span class="p">(</span><span class="n">best_value</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="n">best_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ave_accuracies_per_range_val</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">ave_accuracies_per_range_val</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">best_value</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Best Ranges: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, Accuracy = </span><span class="si">{</span><span class="nb">round</span>        <span class="p">(</span><span class="n">best_value</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">best_value</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">best_ranges</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">best_value</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Best Range: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">best_ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">, Accuracy = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">best_value</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Weighted Levenshtein Accuracy&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Range Threshold&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Classifier Accuracy vs. Range Threshold for Window Size of 0.46 Seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>The following python packages were used in this report: Numpy <span id="id7">[<a class="reference internal" href="#id24">HMvdW+20</a>]</span>, Pandas <span id="id8">[<a class="reference internal" href="#id25">RMj+21</a>]</span>, Scipy <span id="id9">[<a class="reference internal" href="#id26">VGO+20</a>]</span>, matplotlib <span id="id10">[<a class="reference internal" href="#id27">Hun07</a>]</span>, catch22 <span id="id11">[<a class="reference internal" href="#id28">LSK+19</a>]</span>, sci-kit learn <span id="id12">[<a class="reference internal" href="#id29">PVG+11</a>]</span>, numba <span id="id13">[<a class="reference internal" href="#id30">LPS15</a>]</span>, levdist <span id="id14">[<a class="reference internal" href="#id31">Su18</a>]</span>, and pyserial <span id="id15">[<a class="reference internal" href="#id32">Lie20</a>]</span></p>
<p id="id16"><dl class="citation">
<dt class="label" id="id19"><span class="brackets">BYB</span><span class="fn-backref">(<a href="#id1">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p>The heart and brain spikerbox. URL: <a class="reference external" href="https://backyardbrains.com/products/heartAndBrainSpikerBox">https://backyardbrains.com/products/heartAndBrainSpikerBox</a>.</p>
</dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id2">VR21</a></span></dt>
<dd><p>Mar 2021. URL: <a class="reference external" href="https://www.grandviewresearch.com/industry-analysis/virtual-reality-vr-market">https://www.grandviewresearch.com/industry-analysis/virtual-reality-vr-market</a>.</p>
</dd>
<dt class="label" id="id23"><span class="brackets"><a class="fn-backref" href="#id6">Bil18</a></span></dt>
<dd><p>Aleksey Bilogur. Automated feature selection with sklearn. 2018. URL: <a class="reference external" href="https://www.kaggle.com/residentmario/automated-feature-selection-with-sklearn">https://www.kaggle.com/residentmario/automated-feature-selection-with-sklearn</a>.</p>
</dd>
<dt class="label" id="id20"><span class="brackets">Bro20</span></dt>
<dd><p>Jason Brownlee. A gentle introduction to the fbeta-measure for machine learning. Jan 2020. URL: <a class="reference external" href="https://machinelearningmastery.com/fbeta-measure-for-machine-learning/">https://machinelearningmastery.com/fbeta-measure-for-machine-learning/</a>.</p>
</dd>
<dt class="label" id="id18"><span class="brackets"><a class="fn-backref" href="#id3">con21</a></span></dt>
<dd><p>Wikipedia contributors. Space invaders. 2021. Online; accessed 10-June-2021. URL: <a class="reference external" href="https://en.wikipedia.org/w/index.php?title=Space_Invaders&amp;oldid=1027084097">https://en.wikipedia.org/w/index.php?title=Space_Invaders&amp;oldid=1027084097</a>.</p>
</dd>
<dt class="label" id="id21"><span class="brackets">Fah19</span></dt>
<dd><p>Eadan Fahey. Simple ipc using named pipes. Jul 2019. URL: <a class="reference external" href="https://www.eadan.net/blog/ipc-with-named-pipes/">https://www.eadan.net/blog/ipc-with-named-pipes/</a>.</p>
</dd>
<dt class="label" id="id24"><span class="brackets"><a class="fn-backref" href="#id7">HMvdW+20</a></span></dt>
<dd><p>Charles R. Harris, K. Jarrod Millman, Stéfan J. van der Walt, Ralf Gommers, Pauli Virtanen, David Cournapeau, Eric Wieser, Julian Taylor, Sebastian Berg, Nathaniel J. Smith, Robert Kern, Matti Picus, Stephan Hoyer, Marten H. van Kerkwijk, Matthew Brett, Allan Haldane, Jaime Fernández del Río, Mark Wiebe, Pearu Peterson, Pierre Gérard-Marchant, Kevin Sheppard, Tyler Reddy, Warren Weckesser, Hameer Abbasi, Christoph Gohlke, and Travis E. Oliphant. Array programming with NumPy. <em>Nature</em>, 585(7825):357–362, September 2020. URL: <a class="reference external" href="https://doi.org/10.1038/s41586-020-2649-2">https://doi.org/10.1038/s41586-020-2649-2</a>, <a class="reference external" href="https://doi.org/10.1038/s41586-020-2649-2">doi:10.1038/s41586-020-2649-2</a>.</p>
</dd>
<dt class="label" id="id27"><span class="brackets"><a class="fn-backref" href="#id10">Hun07</a></span></dt>
<dd><p>J. D. Hunter. Matplotlib: a 2d graphics environment. <em>Computing in Science &amp; Engineering</em>, 9(3):90–95, 2007. <a class="reference external" href="https://doi.org/10.1109/MCSE.2007.55">doi:10.1109/MCSE.2007.55</a>.</p>
</dd>
<dt class="label" id="id30"><span class="brackets"><a class="fn-backref" href="#id13">LPS15</a></span></dt>
<dd><p>Siu Kwan Lam, Antoine Pitrou, and Stanley Seibert. Numba: a llvm-based python jit compiler. In <em>Proceedings of the Second Workshop on the LLVM Compiler Infrastructure in HPC</em>, LLVM '15. New York, NY, USA, 2015. Association for Computing Machinery. URL: <a class="reference external" href="https://doi.org/10.1145/2833157.2833162">https://doi.org/10.1145/2833157.2833162</a>, <a class="reference external" href="https://doi.org/10.1145/2833157.2833162">doi:10.1145/2833157.2833162</a>.</p>
</dd>
<dt class="label" id="id32"><span class="brackets"><a class="fn-backref" href="#id15">Lie20</a></span></dt>
<dd><p>Chris Liechti. Pyserial. 2020. URL: <a class="reference external" href="https://pyserial.readthedocs.io/en/latest/pyserial.html">https://pyserial.readthedocs.io/en/latest/pyserial.html</a>.</p>
</dd>
<dt class="label" id="id28"><span class="brackets"><a class="fn-backref" href="#id11">LSK+19</a></span></dt>
<dd><p>Carl H. Lubba, Sarab S. Sethi, Philip Knaute, Simon R. Schultz, Ben D. Fulcher, and Nick S. Jones. Catch22: canonical time-series characteristics. <em>Data Mining and Knowledge Discovery</em>, 33:1821–1852, 2019. URL: <a class="reference external" href="https://doi.org/10.1007/s10618-019-00647-x">https://doi.org/10.1007/s10618-019-00647-x</a>, <a class="reference external" href="https://doi.org/10.1007/s10618-019-00647-x">doi:10.1007/s10618-019-00647-x</a>.</p>
</dd>
<dt class="label" id="id29"><span class="brackets"><a class="fn-backref" href="#id12">PVG+11</a></span></dt>
<dd><p>F. Pedregosa, G. Varoquaux, A. Gramfort, V. Michel, B. Thirion, O. Grisel, M. Blondel, P. Prettenhofer, R. Weiss, V. Dubourg, J. Vanderplas, A. Passos, D. Cournapeau, M. Brucher, M. Perrot, and E. Duchesnay. Scikit-learn: machine learning in Python. <em>Journal of Machine Learning Research</em>, 12:2825–2830, 2011.</p>
</dd>
<dt class="label" id="id25"><span class="brackets"><a class="fn-backref" href="#id8">RMj+21</a></span></dt>
<dd><p>Jeff Reback, Wes McKinney, jbrockmendel, Joris Van den Bossche, Tom Augspurger, Phillip Cloud, gfyoung, Simon Hawkins, Sinhrks, Matthew Roeschke, Adam Klein, Terji Petersen, Jeff Tratner, Chang She, William Ayd, Shahar Naveh, Marc Garcia, patrick, Jeremy Schendel, Andy Hayden, Daniel Saxton, Vytautas Jancauskas, Richard Shadrach, Marco Gorelli, Ali McMaster, Pietro Battiston, Skipper Seabold, Kaiqi Dong, chris-b1, and h-vetinari. Pandas-dev/pandas: pandas 1.2.3. mar 2021. URL: <a class="reference external" href="https://doi.org/10.5281/zenodo.4572994">https://doi.org/10.5281/zenodo.4572994</a>, <a class="reference external" href="https://doi.org/10.5281/zenodo.4572994">doi:10.5281/zenodo.4572994</a>.</p>
</dd>
<dt class="label" id="id31"><span class="brackets"><a class="fn-backref" href="#id14">Su18</a></span></dt>
<dd><p>David Su. Weighted levenshtein 0.2.1. 2018. URL: <a class="reference external" href="https://pypi.org/project/weighted-levenshtein/">https://pypi.org/project/weighted-levenshtein/</a>.</p>
</dd>
<dt class="label" id="id22"><span class="brackets">unu11</span></dt>
<dd><p>unutbu. How to find the groups of consecutive elements in a numpy array. Sep 2011. URL: <a class="reference external" href="https://stackoverflow.com/questions/7352684/how-to-find-the-groups-of-consecutive-elements-in-a-numpy-array">https://stackoverflow.com/questions/7352684/how-to-find-the-groups-of-consecutive-elements-in-a-numpy-array</a>.</p>
</dd>
<dt class="label" id="id26"><span class="brackets"><a class="fn-backref" href="#id9">VGO+20</a></span></dt>
<dd><p>Pauli Virtanen, Ralf Gommers, Travis E. Oliphant, Matt Haberland, Tyler Reddy, David Cournapeau, Evgeni Burovski, Pearu Peterson, Warren Weckesser, Jonathan Bright, Stéfan J. van der Walt, Matthew Brett, Joshua Wilson, K. Jarrod Millman, Nikolay Mayorov, Andrew R. J. Nelson, Eric Jones, Robert Kern, Eric Larson, C J Carey, İlhan Polat, Yu Feng, Eric W. Moore, Jake VanderPlas, Denis Laxalde, Josef Perktold, Robert Cimrman, Ian Henriksen, E. A. Quintero, Charles R. Harris, Anne M. Archibald, Antônio H. Ribeiro, Fabian Pedregosa, Paul van Mulbregt, and SciPy 1.0 Contributors. SciPy 1.0: Fundamental Algorithms for Scientific Computing in Python. <em>Nature Methods</em>, 17:261–272, 2020. <a class="reference external" href="https://doi.org/10.1038/s41592-019-0686-2">doi:10.1038/s41592-019-0686-2</a>.</p>
</dd>
</dl>
</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Brain10<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>